<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="theme-color" content="#10b981">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="CaloriePro">
    <meta name="description" content="Track calories, nutrition, BMI and exercise - all data stored locally on your device">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' blob:; script-src 'self' 'unsafe-inline' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com blob:; style-src 'self' 'unsafe-inline'; connect-src 'self' https://world.openfoodfacts.org https://api.emailjs.com; img-src 'self' data: blob:; font-src 'self'; worker-src 'self' blob:">
    <meta name="format-detection" content="telephone=no">
    <meta name="mobile-web-app-capable" content="yes">
    <title>CaloriePro - Calorie Counter</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="167x167" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="152x152" href="icon-192.png">
    <!-- Non-critical scripts: defer so they don't block first paint -->
    <script defer src="https://cdn.jsdelivr.net/npm/@ericblade/quagga2/dist/quagga.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
        :root{--primary:#10b981;--primary-dark:#059669;--secondary:#3b82f6;--danger:#ef4444;--warning:#f59e0b;--purple:#8b5cf6;--bg-dark:#0f172a;--bg-card:#1e293b;--bg-input:#334155;--text-primary:#f1f5f9;--text-secondary:#9cb0c4;--border:#475569;--shadow:0 4px 6px -1px rgba(0,0,0,0.3);--safe-top:env(safe-area-inset-top);--safe-bottom:env(safe-area-inset-bottom)}
        [data-theme="light"]{--bg-dark:#f1f5f9;--bg-card:#ffffff;--bg-input:#e2e8f0;--text-primary:#1e293b;--text-secondary:#556478;--border:#cbd5e1;--shadow:0 4px 6px -1px rgba(0,0,0,0.1)}
        @media(prefers-color-scheme:dark){:root:not([data-theme="light"]){--bg-dark:#0f172a;--bg-card:#1e293b;--bg-input:#334155;--text-primary:#f1f5f9;--text-secondary:#9cb0c4;--border:#475569}}
        @media(prefers-color-scheme:light){:root:not([data-theme="dark"]){--bg-dark:#f1f5f9;--bg-card:#ffffff;--bg-input:#e2e8f0;--text-primary:#1e293b;--text-secondary:#556478;--border:#cbd5e1}}
        html{overscroll-behavior:none;-webkit-overflow-scrolling:touch;height:100%}
        body{font-family:-apple-system,BlinkMacSystemFont,'SF Pro Text','Segoe UI',Roboto,Helvetica,Arial,sans-serif;background:var(--bg-dark);color:var(--text-primary);min-height:100vh;padding-top:var(--safe-top);padding-bottom:calc(80px + var(--safe-bottom));transition:background 0.3s,color 0.3s;-webkit-font-smoothing:antialiased}
        .splash-screen{position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,#10b981,#059669);display:flex;flex-direction:column;align-items:center;justify-content:center;z-index:99999;transition:opacity 0.5s,visibility 0.5s}
        .splash-screen.hidden{opacity:0;visibility:hidden}
        .splash-logo{font-size:4rem;margin-bottom:16px;animation:pulse 2s infinite}
        .splash-title{font-size:1.5rem;font-weight:700;color:white;margin-bottom:8px}
        .splash-subtitle{font-size:0.9rem;color:rgba(255,255,255,0.8)}
        .splash-loader{width:40px;height:40px;border:3px solid rgba(255,255,255,0.3);border-top-color:white;border-radius:50%;margin-top:24px;animation:spin 1s linear infinite}
        @keyframes spin{to{transform:rotate(360deg)}}
        @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.1)}}
        /* header removed - greeting card used instead */
        .bottom-nav{position:fixed;bottom:0;left:0;right:0;background:var(--bg-card);display:flex;justify-content:space-around;padding:6px 0;padding-bottom:calc(6px + var(--safe-bottom));border-top:1px solid var(--border);z-index:100}
        .fab{position:fixed;bottom:calc(70px + var(--safe-bottom));right:16px;width:56px;height:56px;border-radius:50%;background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:#fff;border:none;font-size:1.8rem;display:flex;align-items:center;justify-content:center;box-shadow:0 4px 16px rgba(16,185,129,0.4);z-index:99;cursor:pointer;transition:transform 0.2s;-webkit-tap-highlight-color:transparent}.fab:active{transform:scale(0.9)}
        .nav-item{display:flex;flex-direction:column;align-items:center;gap:2px;padding:8px 12px;min-width:60px;min-height:50px;border-radius:10px;cursor:pointer;transition:all 0.2s;color:var(--text-secondary);font-size:0.65rem;font-weight:500;-webkit-tap-highlight-color:transparent}
        .nav-item:active{transform:scale(0.95)}
        .nav-item.active{color:var(--primary);background:rgba(16,185,129,0.1)}
        .nav-item span:first-child{font-size:1.4rem}
        .main-content{padding:12px;max-width:600px;margin:0 auto}
        .page{display:none;opacity:0}.page.active{display:block;animation:pageIn 0.25s ease forwards}
        @keyframes pageIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        .card{background:var(--bg-card);border-radius:16px;padding:16px;margin-bottom:12px;box-shadow:var(--shadow)}
        .card-title{font-size:1rem;font-weight:600;margin-bottom:12px;display:flex;align-items:center;gap:8px}
        .stats-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-bottom:12px}
        .stats-grid-4{grid-template-columns:repeat(4,1fr)}
        .stat-card{background:var(--bg-input);border-radius:12px;padding:12px;text-align:center}
        .stat-value{font-size:1.5rem;font-weight:700;color:var(--primary)}
        .stat-label{font-size:0.7rem;color:var(--text-secondary);margin-top:2px}
        .stat-card.calories .stat-value{color:#f59e0b}
        .stat-card.protein .stat-value{color:#ef4444}
        .stat-card.carbs .stat-value{color:#3b82f6}
        .stat-card.fat .stat-value{color:#8b5cf6}
        .progress-container{display:flex;flex-direction:column;align-items:center;padding:16px}
        .progress-ring{position:relative;width:160px;height:160px}
        .progress-ring svg{transform:rotate(-90deg)}
        .progress-ring circle{fill:none;stroke-width:12}
        .progress-ring .bg{stroke:var(--bg-input)}
        .progress-ring .progress{stroke:var(--primary);stroke-linecap:round;transition:stroke-dashoffset 0.5s ease}
        .progress-ring .progress.over{stroke:var(--danger)}
        .progress-ring .progress.complete{stroke:var(--primary);filter:drop-shadow(0 0 6px var(--primary))}
        .progress-ring.ring-pulse{animation:ringPulse 0.6s ease}
        @keyframes ringPulse{0%{transform:scale(1)}30%{transform:scale(1.08)}60%{transform:scale(0.97)}100%{transform:scale(1)}}
        .progress-text{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
        .progress-text .value{font-size:1.8rem;font-weight:700}
        .progress-text .label{font-size:0.75rem;color:var(--text-secondary)}
        .form-group{margin-bottom:12px}
        .form-label{display:block;font-size:0.8rem;font-weight:500;color:var(--text-secondary);margin-bottom:4px}
        .form-input,.form-select{width:100%;padding:10px 14px;background:var(--bg-input);border:1px solid var(--border);border-radius:10px;color:var(--text-primary);font-size:0.95rem;font-family:inherit}
        .form-input:focus,.form-select:focus{outline:none;border-color:var(--primary)}
        .form-row{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
        .form-row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .btn{display:inline-flex;align-items:center;justify-content:center;gap:6px;padding:12px 20px;min-height:44px;border:none;border-radius:10px;font-size:0.9rem;font-weight:600;font-family:inherit;cursor:pointer;transition:all 0.2s;width:100%;-webkit-tap-highlight-color:transparent}
        .btn:active{transform:scale(0.98)}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover,.btn-primary:active{background:var(--primary-dark)}
        .btn-secondary{background:var(--secondary);color:white}
        .btn-danger{background:var(--danger);color:white}
        .btn-warning{background:var(--warning);color:white}
        .btn-outline{background:transparent;border:2px solid var(--border);color:var(--text-primary)}
        .btn-sm{padding:8px 14px;min-height:36px;font-size:0.8rem}
        .btn-group{display:flex;gap:8px;margin-top:12px}
        .btn-group .btn{flex:1}
        .list-item{display:flex;justify-content:space-between;align-items:center;padding:12px;min-height:56px;background:var(--bg-input);border-radius:10px;margin-bottom:6px;cursor:pointer;-webkit-tap-highlight-color:transparent}
        .list-item:active{background:var(--bg-card);transform:scale(0.99)}
        .meal-group{margin-bottom:16px}
        .meal-group-header{display:flex;justify-content:space-between;align-items:center;padding:8px 4px;margin-bottom:6px;border-bottom:1px solid var(--border)}
        .meal-group-title{font-size:0.85rem;font-weight:600;display:flex;align-items:center;gap:6px}
        .meal-group-cal{font-size:0.85rem;font-weight:700;color:var(--warning)}
        .swipe-container{border-radius:10px;margin-bottom:6px;overflow-x:auto;overflow-y:hidden;display:flex;-webkit-overflow-scrolling:touch;scrollbar-width:none;-ms-overflow-style:none}
        .swipe-container::-webkit-scrollbar{display:none}
        .swipe-item{flex:0 0 100%;display:flex;justify-content:space-between;align-items:center;padding:12px;min-height:56px;background:var(--bg-input);-webkit-tap-highlight-color:transparent}
        .swipe-item .list-item-content{flex:1;min-width:0}
        .swipe-item .list-item-title{font-weight:500;font-size:0.9rem;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .swipe-item .list-item-subtitle{font-size:0.75rem;color:var(--text-secondary)}
        .swipe-item .list-item-value{font-weight:600;font-size:0.85rem;color:var(--warning);white-space:nowrap;margin-left:10px}
        .swipe-actions{display:flex;flex-shrink:0}
        .swipe-action{display:flex;align-items:center;justify-content:center;width:70px;color:white;font-size:0.75rem;font-weight:600;flex-direction:column;gap:2px;cursor:pointer;-webkit-tap-highlight-color:rgba(255,255,255,0.2)}
        .swipe-action.edit{background:var(--secondary)}
        .swipe-action.delete{background:var(--danger)}
        .swipe-action span{font-size:1.1rem}
        .list-item-content{flex:1;min-width:0}
        .list-item-title{font-weight:500;font-size:0.9rem;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .list-item-subtitle{font-size:0.75rem;color:var(--text-secondary)}
        .list-item-value{font-weight:600;font-size:0.85rem;color:var(--warning);white-space:nowrap;margin-left:10px}
        .list-item-actions{display:flex;gap:4px;margin-left:8px}
        .icon-btn{min-width:44px;min-height:44px;width:44px;height:44px;border:none;border-radius:10px;background:var(--bg-card);color:var(--text-secondary);cursor:pointer;font-size:1.1rem;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent}
        .icon-btn:hover,.icon-btn:active{background:var(--danger);color:white}
        .icon-btn.add:hover,.icon-btn.add:active{background:var(--primary)}
        .meal-tabs{display:flex;gap:6px;margin-bottom:12px;overflow-x:auto;padding-bottom:4px}
        .meal-tab{padding:8px 14px;background:var(--bg-input);border:none;border-radius:20px;color:var(--text-secondary);font-size:0.8rem;font-weight:500;cursor:pointer;white-space:nowrap}
        .meal-tab.active{background:var(--primary);color:white}
        .bmi-result{text-align:center;padding:16px;background:var(--bg-input);border-radius:12px;margin-top:12px}
        .bmi-value{font-size:2.5rem;font-weight:700}
        .bmi-category{font-size:1rem;margin-top:4px}
        .bmi-target{font-size:0.85rem;color:var(--text-secondary);margin-top:6px}
        .bmi-underweight{color:#3b82f6}.bmi-normal{color:#10b981}.bmi-overweight{color:#f59e0b}.bmi-obese{color:#ef4444}
        .empty-state{text-align:center;padding:30px 20px;color:var(--text-secondary)}
        .empty-state-icon{font-size:2.5rem;margin-bottom:12px}
        .quick-add{display:grid;grid-template-columns:repeat(4,1fr);gap:6px;margin-bottom:12px}
        .quick-add-btn{padding:12px 8px;min-width:60px;min-height:60px;background:var(--bg-input);border:none;border-radius:12px;color:var(--text-primary);font-size:0.7rem;cursor:pointer;text-align:center;-webkit-tap-highlight-color:transparent}
        .quick-add-btn:hover,.quick-add-btn:active{background:var(--primary);color:white}
        .quick-add-btn span{display:block;font-size:1.4rem;margin-bottom:4px}
        .section-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
        .section-title{font-size:1rem;font-weight:600;display:flex;align-items:center;gap:6px}
        .section-header .btn-sm{border-radius:20px;padding:8px 16px;font-size:0.8rem;box-shadow:0 2px 8px rgba(16,185,129,0.25)}
        .modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:200;align-items:flex-end;justify-content:center}
        .modal-overlay.active{display:flex}
        .modal{background:var(--bg-card);border-radius:20px 20px 0 0;width:100%;max-width:500px;max-height:85vh;overflow-y:auto;padding:20px;animation:slideUp 0.3s ease}
        @keyframes slideUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}
        .modal-title{font-size:1.1rem;font-weight:600}
        .modal-close{min-width:44px;min-height:44px;width:44px;height:44px;border:none;border-radius:50%;background:var(--bg-input);color:var(--text-primary);font-size:1.2rem;cursor:pointer;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent}
        .modal-close:active{background:var(--danger);color:white;transform:scale(0.95)}
        .scanner-container{position:relative;width:100%;max-width:100%;margin:0 auto;border-radius:12px;overflow:hidden;background:#000;aspect-ratio:4/3}
        #scanner-viewport{width:100%;height:100%;position:relative}
        #scanner-viewport video,#scanner-viewport canvas{position:absolute;top:0;left:0;width:100%!important;height:100%!important;object-fit:cover}
        .scanner-overlay{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:50%;border:3px solid var(--primary);border-radius:8px;box-shadow:0 0 0 9999px rgba(0,0,0,0.4);z-index:10;pointer-events:none}
        .scanner-laser{position:absolute;left:10%;width:80%;height:2px;background:linear-gradient(90deg,transparent,var(--primary),transparent);z-index:11;pointer-events:none;animation:laserSweep 2s ease-in-out infinite;box-shadow:0 0 8px var(--primary)}
        @keyframes laserSweep{0%{top:30%}50%{top:65%}100%{top:30%}}
        .scanner-torch{position:absolute;top:10px;right:10px;z-index:12;width:36px;height:36px;border-radius:50%;background:rgba(0,0,0,0.5);border:2px solid rgba(255,255,255,0.3);color:white;font-size:1.1rem;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all 0.2s}
        .scanner-torch.active{background:var(--warning);border-color:var(--warning);color:#000}
        .scanner-status{text-align:center;padding:12px;font-size:0.85rem;color:var(--text-secondary)}
        .scan-progress{display:flex;gap:6px;justify-content:center;margin-top:6px}
        .scan-dot{width:8px;height:8px;border-radius:50%;background:var(--border);transition:background 0.2s}
        .scan-dot.matched{background:var(--primary)}
        .scan-history-section{margin-top:12px;border-top:1px solid var(--border);padding-top:10px}
        .scan-history-title{font-size:0.75rem;font-weight:600;color:var(--text-secondary);margin-bottom:6px}
        .scan-history-item{display:flex;align-items:center;justify-content:space-between;padding:8px;background:var(--bg-input);border-radius:8px;margin-bottom:4px;cursor:pointer;transition:background 0.15s}
        .scan-history-item:active{background:var(--bg-card)}
        .scan-history-item .shi-name{font-size:0.8rem;font-weight:500}
        .scan-history-item .shi-detail{font-size:0.65rem;color:var(--text-secondary)}
        .scan-history-item .shi-cal{font-size:0.85rem;font-weight:600;color:var(--warning)}
        .scanned-product{background:var(--bg-input);border-radius:12px;padding:16px;margin-top:12px}
        .scanned-product-name{font-size:1.1rem;font-weight:600;margin-bottom:4px}
        .scanned-product-brand{font-size:0.85rem;color:var(--text-secondary);margin-bottom:12px}
        .scanned-product-macros{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;text-align:center}
        .scanned-product-macros div{background:var(--bg-card);padding:8px;border-radius:8px}
        .scanned-product-macros .value{font-weight:600;font-size:1.1rem}
        .scanned-product-macros .label{font-size:0.7rem;color:var(--text-secondary)}
        .data-warning{background:rgba(245,158,11,0.1);border:1px solid rgba(245,158,11,0.3);border-radius:8px;padding:8px 10px;margin-top:8px;font-size:0.7rem;color:var(--warning);display:flex;align-items:center;gap:6px}
        .progress-photos{display:flex;gap:8px;overflow-x:auto;padding:8px 0;-webkit-overflow-scrolling:touch}
        .progress-photo{position:relative;width:72px;height:72px;border-radius:10px;overflow:hidden;flex-shrink:0;cursor:pointer}
        .progress-photo img{width:100%;height:100%;object-fit:cover}
        .progress-photo .pp-date{position:absolute;bottom:0;left:0;right:0;background:rgba(0,0,0,0.6);color:white;font-size:0.5rem;text-align:center;padding:2px}
        .progress-photo .pp-weight{position:absolute;top:4px;right:4px;background:var(--primary);color:white;font-size:0.5rem;padding:1px 4px;border-radius:4px;font-weight:600}
        .photo-viewer{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);z-index:10000;display:flex;flex-direction:column;align-items:center;justify-content:center}
        .photo-viewer img{max-width:90%;max-height:70vh;border-radius:12px;object-fit:contain}
        .photo-viewer-info{color:white;text-align:center;margin-top:12px;font-size:0.9rem}
        .photo-viewer-close{position:absolute;top:max(20px,env(safe-area-inset-top));right:16px;color:white;font-size:1.8rem;cursor:pointer;z-index:10001;background:rgba(255,255,255,0.15);width:36px;height:36px;border-radius:50%;display:flex;align-items:center;justify-content:center;border:none}
        .streak-recovery{background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(239,68,68,0.1));border:1px solid rgba(245,158,11,0.3);border-radius:12px;padding:14px;margin-bottom:12px;text-align:center}
        .streak-recovery .sr-title{font-weight:600;font-size:0.9rem;margin-bottom:4px}
        .streak-recovery .sr-text{font-size:0.8rem;color:var(--text-secondary);margin-bottom:8px}
        .weight-projection{background:var(--bg-input);border-radius:10px;padding:12px;margin-top:10px;text-align:center}
        .weight-projection .wp-date{font-size:1rem;font-weight:700;color:var(--primary)}
        .weight-projection .wp-label{font-size:0.75rem;color:var(--text-secondary);margin-top:2px}
        .weight-projection .wp-rate{font-size:0.7rem;color:var(--text-secondary);margin-top:6px;opacity:0.8}
        .theme-selector{display:flex;gap:8px;margin-top:4px}
        .theme-opt{flex:1;padding:10px;border-radius:10px;border:2px solid var(--border);background:var(--bg-input);text-align:center;cursor:pointer;transition:all 0.2s;font-size:0.8rem}
        .theme-opt.active{border-color:var(--primary);background:rgba(16,185,129,0.1)}
        .theme-opt-icon{font-size:1.3rem;display:block;margin-bottom:4px}
        .onboarding-features{display:grid;grid-template-columns:1fr 1fr;gap:8px;margin:12px 0;text-align:left}
        .onboarding-feature{background:var(--bg-input);border-radius:10px;padding:10px;text-align:center}
        .onboarding-feature .of-icon{font-size:1.5rem;margin-bottom:4px}
        .onboarding-feature .of-text{font-size:0.7rem;color:var(--text-secondary)}
        .toast{position:fixed;bottom:calc(90px + var(--safe-bottom));left:50%;transform:translateX(-50%);background:#10b981;color:#fff;padding:12px 24px;border-radius:25px;box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:500;display:none;font-size:0.9rem;font-weight:600;min-width:200px;text-align:center}
        .toast.show{display:block;animation:fadeInUp 0.3s ease}
        @keyframes fadeInUp{from{opacity:0;transform:translate(-50%,20px)}to{opacity:1;transform:translate(-50%,0)}}
        .loading-spinner{display:inline-block;width:20px;height:20px;border:2px solid var(--border);border-top-color:var(--primary);border-radius:50%;animation:spin 0.8s linear infinite;vertical-align:middle;margin-right:8px}
        .btn.loading{pointer-events:none;opacity:0.7}
        .btn.loading::before{content:'';display:inline-block;width:16px;height:16px;border:2px solid currentColor;border-top-color:transparent;border-radius:50%;animation:spin 0.8s linear infinite;margin-right:8px;vertical-align:middle}
        .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}
        .pull-indicator{text-align:center;padding:10px;color:var(--text-secondary);font-size:0.85rem;max-height:0;overflow:hidden;transition:max-height 0.3s ease,opacity 0.3s ease;opacity:0}
        .pull-indicator.visible{max-height:50px;opacity:1}
        .pull-indicator.refreshing .pull-spinner{display:inline-block;animation:spin 0.8s linear infinite}
        .pull-spinner{display:none}
        @keyframes spin{to{transform:rotate(360deg)}}
        .form-input.error,.form-select.error{border-color:var(--danger);animation:shake 0.3s}
        .form-error{color:var(--danger);font-size:0.75rem;margin-top:4px;display:none}
        .form-error.visible{display:block}
        @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(-5px)}75%{transform:translateX(5px)}}
        .category-badge{display:inline-block;padding:2px 8px;border-radius:10px;font-size:0.65rem;font-weight:500;background:var(--bg-card);color:var(--text-secondary)}
        .scrollable-list{max-height:280px;overflow-y:auto}
        .search-box{position:relative;margin-bottom:12px}
        .search-box input{padding-left:40px}
        .search-box::before{content:"üîç";position:absolute;left:12px;top:50%;transform:translateY(-50%);font-size:1rem}
        .report-card{background:var(--bg-input);border-radius:12px;padding:14px;margin-bottom:10px}
        .report-value{font-size:1.8rem;font-weight:700}
        .report-subtitle{font-size:0.75rem;color:var(--text-secondary);margin-top:4px}
        .insight-box{background:linear-gradient(135deg,var(--bg-input),var(--bg-card));border-left:4px solid var(--primary);padding:12px;border-radius:0 10px 10px 0;margin-bottom:10px}
        .insight-box.warning{border-left-color:var(--warning)}
        .insight-box.danger{border-left-color:var(--danger)}
        .insight-title{font-weight:600;font-size:0.85rem;margin-bottom:4px}
        .insight-text{font-size:0.8rem;color:var(--text-secondary);line-height:1.4}
        .progress-bar{height:8px;background:var(--bg-card);border-radius:4px;overflow:hidden;margin:8px 0}
        .progress-bar-fill{height:100%;border-radius:4px;transition:width 0.3s ease}
        .progress-bar-fill.green{background:var(--primary)}
        .progress-bar-fill.yellow{background:var(--warning)}
        .progress-bar-fill.red{background:var(--danger)}
        .week-chart{display:flex;justify-content:space-between;align-items:flex-end;height:120px;padding:10px 0}
        .week-bar{flex:1;display:flex;flex-direction:column;align-items:center;gap:4px}
        .week-bar-fill{width:70%;max-width:30px;background:var(--primary);border-radius:4px 4px 0 0;min-height:4px}
        .week-bar-fill.over{background:var(--danger)}
        .week-bar-label{font-size:0.65rem;color:var(--text-secondary)}
        .week-bar-value{font-size:0.6rem;color:var(--text-secondary)}
        .category-tabs{display:flex;gap:6px;overflow-x:auto;padding-bottom:8px;margin-bottom:12px;scroll-behavior:smooth;-webkit-overflow-scrolling:touch;-ms-overflow-style:none;scrollbar-width:none;mask-image:linear-gradient(to right,transparent,black 12px,black calc(100% - 24px),transparent);-webkit-mask-image:linear-gradient(to right,transparent,black 12px,black calc(100% - 24px),transparent)}
        .category-tabs::-webkit-scrollbar{display:none}
        .mini-chart{display:flex;align-items:flex-end;gap:4px;height:50px;margin-top:12px;padding:16px 4px 16px;position:relative}
        .mini-chart-bar{flex:1;min-width:0;border-radius:4px 4px 0 0;transition:height 0.4s ease;position:relative}
        .mini-chart-bar .mini-label{position:absolute;bottom:-14px;left:50%;transform:translateX(-50%);font-size:0.5rem;color:var(--text-secondary);white-space:nowrap}
        .mini-chart-bar .mini-val{position:absolute;top:-14px;left:50%;transform:translateX(-50%);font-size:0.5rem;color:var(--text-secondary);white-space:nowrap;opacity:0;transition:opacity 0.2s}
        .mini-chart-bar:active .mini-val{opacity:1}
        .category-tab{padding:6px 12px;background:var(--bg-input);border:none;border-radius:15px;color:var(--text-secondary);font-size:0.75rem;font-weight:500;cursor:pointer;white-space:nowrap}
        .category-tab.active{background:var(--secondary);color:white}
        .portion-btn{padding:8px 14px;background:var(--bg-input);border:2px solid transparent;border-radius:10px;color:var(--text-primary);font-size:0.85rem;font-weight:600;cursor:pointer;min-width:42px;text-align:center;transition:all 0.15s}
        .portion-btn.active{background:var(--secondary);color:white;border-color:var(--secondary)}
        .portion-btn:hover{border-color:var(--secondary)}
        .privacy-notice{font-size:0.7rem;color:var(--text-secondary);text-align:center;padding:10px;background:var(--bg-input);border-radius:10px;margin-top:12px}
        .privacy-notice strong{color:var(--primary)}
        .water-glasses{display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
        .water-glass{width:40px;height:48px;border:2px solid var(--secondary);border-radius:6px 6px 10px 10px;position:relative;background:var(--bg-input);transition:all 0.3s;cursor:pointer;-webkit-tap-highlight-color:transparent}
        .water-glass:active{transform:scale(0.95)}
        .water-glass.filled{background:linear-gradient(to top,var(--secondary) 85%,transparent 85%)}
        .water-glass.filled::after{content:'üíß';position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:1rem}
        .weight-chart{display:flex;align-items:flex-end;height:100px;gap:4px;padding:10px 0;overflow-x:auto}
        .weight-point{display:flex;flex-direction:column;align-items:center;min-width:40px}
        .weight-bar{width:8px;background:var(--primary);border-radius:4px 4px 0 0;min-height:4px}
        .weight-label{font-size:0.6rem;color:var(--text-secondary);margin-top:4px}
        .weight-value{font-size:0.65rem;font-weight:600;color:var(--primary)}
        .fav-btn{background:none;border:none;font-size:1.2rem;cursor:pointer;padding:4px;opacity:0.4;transition:all 0.2s}
        .fav-btn.active{opacity:1}
        .fav-quick{display:inline-flex;align-items:center;gap:4px;padding:6px 10px;background:var(--warning);border:none;border-radius:15px;color:white;font-size:0.75rem;font-weight:500;cursor:pointer;margin:2px}
        .exercise-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--bg-input);border-radius:8px;margin-bottom:6px}
        .exercise-info{flex:1}
        .exercise-name{font-weight:500;font-size:0.85rem}
        .exercise-detail{font-size:0.7rem;color:var(--text-secondary)}
        .exercise-cal{font-weight:600;color:var(--danger);font-size:0.9rem}
        .net-cal-box{background:linear-gradient(135deg,var(--bg-input),var(--bg-card));padding:12px;border-radius:10px;text-align:center}
        .net-cal-value{font-size:1.5rem;font-weight:700}
        .net-cal-label{font-size:0.75rem;color:var(--text-secondary)}
        .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:4px}
        .calendar-header{font-size:0.65rem;color:var(--text-secondary);text-align:center;padding:4px}
        .calendar-day{aspect-ratio:1;display:flex;align-items:center;justify-content:center;border-radius:8px;font-size:0.75rem;background:var(--bg-input);position:relative;cursor:pointer;transition:transform 0.2s}
        .calendar-day:hover{transform:scale(1.1)}
        .calendar-day.empty{background:transparent;cursor:default}
        .calendar-day.empty:hover{transform:none}
        .calendar-day.cal-green{background:var(--primary);color:white;font-weight:600}
        .calendar-day.cal-yellow{background:var(--warning);color:white;font-weight:600}
        .calendar-day.cal-red{background:var(--danger);color:white;font-weight:600}
        .calendar-day.cal-light{background:rgba(16,185,129,0.25);color:var(--text-primary);font-weight:500}
        .calendar-day.today{border:2px solid var(--warning)}
        .calendar-day.selected{box-shadow:0 0 0 3px var(--secondary);transform:scale(1.1)}
        .mood-selector{display:flex;justify-content:space-between;align-items:center;padding:12px;background:var(--bg-input);border-radius:12px;margin-bottom:12px}
        .mood-btn{font-size:1.8rem;padding:8px;border:none;background:transparent;cursor:pointer;opacity:0.4;transition:all 0.2s;border-radius:50%}
        .mood-btn:hover{opacity:0.7;transform:scale(1.1)}
        .mood-btn.selected{opacity:1;transform:scale(1.2);background:rgba(16,185,129,0.2)}
        .mood-label{font-size:0.7rem;color:var(--text-secondary);text-align:center;margin-top:4px}
        .mood-display{display:inline-flex;align-items:center;gap:4px;font-size:0.8rem;padding:4px 8px;background:var(--bg-input);border-radius:8px}
        .mood-stats{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-top:12px}
        .mood-stat{text-align:center;padding:8px;background:var(--bg-input);border-radius:8px}
        .mood-stat-emoji{font-size:1.5rem}
        .mood-stat-count{font-size:1.1rem;font-weight:600;color:var(--primary)}
        .mood-stat-label{font-size:0.65rem;color:var(--text-secondary)}
        .date-nav{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding:12px 16px;background:var(--bg-card);border-radius:16px;box-shadow:var(--shadow)}
        .date-nav-btn{background:linear-gradient(135deg,var(--primary),var(--primary-dark));color:white;border:none;width:44px;height:44px;border-radius:12px;font-size:1.4rem;font-weight:600;cursor:pointer;display:flex;align-items:center;justify-content:center;-webkit-tap-highlight-color:transparent;box-shadow:0 2px 8px rgba(16,185,129,0.3);transition:all 0.2s}
        .date-nav-btn:hover,.date-nav-btn:active{transform:scale(0.95);box-shadow:0 1px 4px rgba(16,185,129,0.2)}
        .date-nav-btn:disabled{opacity:0.3;cursor:not-allowed;box-shadow:none}
        .date-nav-current{text-align:center;font-weight:600;font-size:1.1rem}
        .date-nav-sub{font-size:0.8rem;color:var(--text-secondary);font-weight:400;margin-top:2px}
        
        .confetti{position:fixed;width:10px;height:10px;top:-10px;z-index:10001;pointer-events:none;animation:confetti-fall 3s linear forwards}
        @keyframes confetti-fall{0%{transform:translateY(0) rotate(0deg);opacity:1}100%{transform:translateY(100vh) rotate(720deg);opacity:0}}
        .macro-rings{display:flex;justify-content:space-around;margin:16px 0}
        .macro-ring{position:relative;width:80px;height:80px}
        .macro-ring svg{transform:rotate(-90deg)}
        .macro-ring circle{fill:none;stroke-width:6}
        .macro-ring .bg{stroke:var(--bg-input)}
        .macro-ring .progress{stroke-linecap:round;transition:stroke-dashoffset 0.5s}
        .macro-ring.ring-pulse{animation:ringPulse 0.6s ease}
        .macro-ring-label{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;width:56px}
        .macro-ring-value{font-size:0.6rem;font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .macro-ring-name{font-size:0.55rem;color:var(--text-secondary)}
        .swipe-hint{text-align:center;font-size:0.7rem;color:var(--text-secondary);margin-top:8px;opacity:0.7}
        .collapsible-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;-webkit-tap-highlight-color:transparent;padding:4px 0}
        .collapse-icon{font-size:1.2rem;color:var(--text-secondary);transition:transform 0.3s ease}
        .collapsible-card.collapsed .collapse-icon{transform:rotate(-90deg)}
        .collapsible-body{max-height:500px;overflow:hidden;transition:max-height 0.3s ease,opacity 0.3s ease;opacity:1;margin-top:12px}
        .collapsible-card.collapsed .collapsible-body{max-height:0;opacity:0;margin-top:0}
        .viewing-past{background:var(--bg-input);border-radius:8px;padding:8px 12px;margin-bottom:12px;display:flex;align-items:center;justify-content:space-between}
        .viewing-past-text{font-size:0.85rem;color:var(--warning)}
        .viewing-past-btn{background:var(--warning);color:white;border:none;padding:6px 12px;border-radius:6px;font-size:0.8rem;cursor:pointer}
        .achievements-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
        .achievement{text-align:center;padding:10px 4px;background:var(--bg-input);border-radius:10px;opacity:0.4}
        .achievement.unlocked{opacity:1;background:linear-gradient(135deg,var(--bg-input),rgba(16,185,129,0.2))}
        .achievement-icon{font-size:1.5rem;margin-bottom:4px}
        .achievement-name{font-size:0.6rem;color:var(--text-secondary)}
        .achievement.unlocked .achievement-name{color:var(--primary);font-weight:500}
        .template-item{display:flex;justify-content:space-between;align-items:center;padding:10px;background:var(--bg-input);border-radius:8px;margin-bottom:6px}
        .template-info{flex:1}
        .template-name{font-weight:600;font-size:0.85rem}
        .template-detail{font-size:0.7rem;color:var(--text-secondary)}
        .template-actions{display:flex;gap:6px}
        .recent-foods-row{display:flex;gap:6px;overflow-x:auto;padding:4px 0 10px 0;-webkit-overflow-scrolling:touch}
        .recent-food-chip{flex-shrink:0;padding:8px 12px;background:var(--bg-input);border-radius:20px;font-size:0.75rem;cursor:pointer;border:1px solid transparent;transition:all 0.2s;white-space:nowrap}
        .recent-food-chip:active{background:var(--primary);color:white;transform:scale(0.95)}
        .recent-food-chip .cal{color:var(--warning);font-weight:600;margin-left:4px}
        .modal-recent-row{display:flex;gap:6px;overflow-x:auto;padding:2px 0 6px;-webkit-overflow-scrolling:touch;scrollbar-width:none}
        .modal-recent-row::-webkit-scrollbar{display:none}
        .modal-recent-chip{flex-shrink:0;display:flex;align-items:center;gap:6px;padding:7px 12px;background:var(--bg-input);border:1px solid var(--border);border-radius:20px;font-size:0.75rem;cursor:pointer;transition:all 0.15s;white-space:nowrap}
        .modal-recent-chip:active{background:var(--primary);color:white;border-color:var(--primary);transform:scale(0.95)}
        .modal-recent-chip .chip-cal{color:var(--warning);font-weight:600;font-size:0.7rem}
        .modal-recent-chip .chip-icon{font-size:0.85rem}
        .saved-meal-chip{flex-shrink:0;display:flex;align-items:center;gap:5px;padding:6px 10px;background:var(--bg-input);border:1px dashed var(--secondary);border-radius:16px;font-size:0.7rem;cursor:pointer;transition:all 0.15s;white-space:nowrap;color:var(--secondary)}
        .saved-meal-chip:active{background:var(--secondary);color:white;transform:scale(0.95)}
        .exercise-item-select{display:flex;align-items:center;padding:10px;background:var(--bg-input);border-radius:8px;margin-bottom:6px;cursor:pointer;border:2px solid transparent;transition:all 0.2s}
        .exercise-item-select.selected{border-color:var(--primary);background:rgba(16,185,129,0.1)}
        .exercise-item-select:active{transform:scale(0.98)}
        /* ===== ROUND 9: POLISH & GAMIFICATION ===== */
        /* Level badge */
        .level-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;background:linear-gradient(135deg,#f59e0b,#d97706);border-radius:20px;font-size:0.7rem;font-weight:700;color:white;white-space:nowrap;box-shadow:0 2px 8px rgba(245,158,11,0.3)}
        .level-badge .xp-bar{width:40px;height:4px;background:rgba(0,0,0,0.2);border-radius:2px;overflow:hidden;margin-left:2px}
        .level-badge .xp-fill{height:100%;background:white;border-radius:2px;transition:width 0.5s ease}
        /* Challenge card */
        .challenge-item{display:flex;align-items:center;gap:10px;padding:10px;background:var(--bg-input);border-radius:10px;margin-bottom:6px}
        .challenge-item.complete{background:linear-gradient(135deg,rgba(16,185,129,0.15),rgba(16,185,129,0.05));border:1px solid rgba(16,185,129,0.3)}
        .challenge-icon{font-size:1.3rem;flex-shrink:0}
        .challenge-info{flex:1;min-width:0}
        .challenge-title{font-size:0.8rem;font-weight:600}
        .challenge-progress{font-size:0.7rem;color:var(--text-secondary)}
        .challenge-bar{width:100%;height:5px;background:var(--bg-card);border-radius:3px;overflow:hidden;margin-top:4px}
        .challenge-bar-fill{height:100%;border-radius:3px;transition:width 0.5s ease}
        .challenge-xp{font-size:0.65rem;font-weight:700;color:var(--warning);white-space:nowrap}
        /* Exercise redesign */
        .exercise-burn-ring{position:relative;width:60px;height:60px;flex-shrink:0}
        .exercise-burn-ring svg{transform:rotate(-90deg)}
        .exercise-burn-ring circle{fill:none;stroke-width:5}
        .exercise-burn-ring .bg{stroke:var(--bg-card)}
        .exercise-burn-ring .burn{stroke:var(--danger);stroke-linecap:round;transition:stroke-dashoffset 0.5s}
        .exercise-burn-ring .burn-val{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
        .exercise-burn-ring .burn-num{font-size:0.8rem;font-weight:700;color:var(--danger)}
        .exercise-burn-ring .burn-label{font-size:0.45rem;color:var(--text-secondary)}
        .exercise-week-chart{display:flex;align-items:flex-end;gap:4px;height:35px;margin-top:8px}
        .exercise-week-bar{flex:1;min-width:0;border-radius:3px 3px 0 0;transition:height 0.4s ease;position:relative}
        .exercise-week-bar .ew-label{position:absolute;bottom:-12px;left:50%;transform:translateX(-50%);font-size:0.45rem;color:var(--text-secondary)}
        /* Achievement toast */
        .achievement-toast{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%) scale(0);background:var(--bg-card);border-radius:20px;padding:24px 32px;text-align:center;z-index:9999;box-shadow:0 20px 60px rgba(0,0,0,0.5);transition:transform 0.4s cubic-bezier(0.34,1.56,0.64,1)}
        .achievement-toast.show{transform:translate(-50%,-50%) scale(1)}
        .achievement-toast-bg{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.6);z-index:9998;opacity:0;transition:opacity 0.3s;pointer-events:none}
        .achievement-toast-bg.show{opacity:1;pointer-events:auto}
        .achievement-toast .at-icon{font-size:3rem;animation:bounce 0.6s ease infinite}
        .achievement-toast .at-title{font-size:1.1rem;font-weight:700;margin-top:8px;color:var(--warning)}
        .achievement-toast .at-sub{font-size:0.8rem;color:var(--text-secondary);margin-top:4px}
        .achievement-toast .at-xp{font-size:0.85rem;font-weight:700;color:var(--primary);margin-top:8px}
        /* Insight severity */
        .insight-card.green{border-left:3px solid var(--primary)}
        .insight-card.yellow{border-left:3px solid var(--warning)}
        .insight-card.red{border-left:3px solid var(--danger)}
        .insight-card.blue{border-left:3px solid var(--secondary)}
        /* Suggestion chips */
        .suggestion-chips{display:flex;gap:6px;flex-wrap:wrap;margin-top:6px}
        .suggestion-chip{padding:4px 10px;background:var(--bg-card);border:1px solid var(--border);border-radius:15px;font-size:0.7rem;cursor:pointer;transition:all 0.15s}
        .suggestion-chip:active{background:var(--primary);color:white;border-color:var(--primary);transform:scale(0.95)}
        /* Card entrance animation */
        .card{animation:cardIn 0.3s ease-out}
        @keyframes cardIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
        /* Smooth transitions */
        .stat-value{transition:color 0.3s}
        .progress-ring .progress{transition:stroke-dashoffset 0.8s cubic-bezier(0.4,0,0.2,1)}
        /* ===== ROUND 10: DATA VIZ, SHARING, SMART, UX ===== */
        /* Calorie trend chart */
        .trend-chart{position:relative;height:140px;padding:4px 0;margin:8px 0}
        .trend-chart canvas{width:100%!important;height:100%!important}
        .trend-legend{display:flex;justify-content:center;gap:16px;margin-top:6px;font-size:0.65rem;color:var(--text-secondary)}
        .trend-legend span{display:flex;align-items:center;gap:4px}
        .trend-legend .dot{width:8px;height:8px;border-radius:50%;display:inline-block}
        /* Macro pie */
        .macro-pie-wrap{display:flex;align-items:center;gap:12px;padding:8px 0;overflow:hidden}
        .macro-pie-wrap canvas{flex-shrink:0;width:100px;height:100px}
        .macro-pie-legend{flex:1;font-size:0.75rem;min-width:0;overflow:hidden}
        .macro-pie-legend div{display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border);gap:8px}
        .macro-pie-legend div:last-child{border:none}
        .macro-pie-legend .mpl-label{display:flex;align-items:center;gap:6px;white-space:nowrap}
        .macro-pie-legend .mpl-dot{width:10px;height:10px;border-radius:2px;flex-shrink:0}
        /* Body stats */
        .body-stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px}
        .body-stat{background:var(--bg-input);border-radius:10px;padding:10px;text-align:center}
        .body-stat .bs-val{font-size:1.3rem;font-weight:700}
        .body-stat .bs-label{font-size:0.65rem;color:var(--text-secondary);margin-top:2px}
        .body-stat .bs-sub{font-size:0.6rem;color:var(--text-secondary)}
        /* Share card */
        .share-card-preview{background:linear-gradient(135deg,var(--primary-dark),var(--primary));border-radius:16px;padding:20px;color:white;text-align:center;margin:12px 0}
        .share-card-preview .sc-cal{font-size:2.5rem;font-weight:800}
        .share-card-preview .sc-label{font-size:0.75rem;opacity:0.8}
        .share-card-preview .sc-macros{display:flex;justify-content:center;gap:20px;margin-top:10px;font-size:0.8rem}
        .share-card-preview .sc-macros span{opacity:0.9}
        .share-card-preview .sc-footer{margin-top:12px;font-size:0.65rem;opacity:0.6}
        /* Settings sections */
        .settings-section{margin-bottom:4px}
        .settings-section-title{font-size:0.7rem;font-weight:600;color:var(--text-secondary);text-transform:uppercase;letter-spacing:0.5px;padding:8px 4px 4px}
        .settings-row{display:flex;align-items:center;justify-content:space-between;padding:10px 4px;border-bottom:1px solid var(--border)}
        .settings-row:last-child{border:none}
        .settings-row .sr-left{display:flex;align-items:center;gap:10px}
        .settings-row .sr-icon{font-size:1.1rem}
        .settings-row .sr-text{font-size:0.85rem;font-weight:500}
        .settings-row .sr-sub{font-size:0.7rem;color:var(--text-secondary)}
        /* Toggle switch */
        .toggle{position:relative;width:44px;height:24px;flex-shrink:0}
        .toggle input{display:none}
        .toggle .slider{position:absolute;inset:0;background:var(--border);border-radius:12px;cursor:pointer;transition:0.3s}
        .toggle .slider:before{content:'';position:absolute;width:18px;height:18px;left:3px;bottom:3px;background:white;border-radius:50%;transition:0.3s}
        .toggle input:checked+.slider{background:var(--primary)}
        .toggle input:checked+.slider:before{transform:translateX(20px)}
        /* Accessibility focus ring */
        .btn:focus-visible,.form-input:focus-visible,.nav-item:focus-visible,.form-select:focus-visible{outline:2px solid var(--primary);outline-offset:2px}
        /* Skip link */
        .skip-link{position:absolute;top:-40px;left:0;background:var(--primary);color:white;padding:8px;z-index:10000;transition:top 0.2s}
        .skip-link:focus{top:0}
        .exercise-icon{font-size:1.2rem;margin-right:10px}
        .exercise-info{flex:1}
        .exercise-name{font-weight:600;font-size:0.85rem}
        .exercise-meta{font-size:0.7rem;color:var(--text-secondary)}
        .food-item-quick{display:flex;align-items:center;padding:12px;min-height:56px;background:var(--bg-input);border-radius:10px;margin-bottom:6px;cursor:pointer;transition:all 0.15s;-webkit-tap-highlight-color:transparent}
        .food-item-quick:active{background:var(--primary);color:white;transform:scale(0.98)}
        .food-item-quick .food-info{flex:1;min-width:0}
        .food-item-quick .food-name{font-weight:500;font-size:0.85rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
        .food-item-quick .food-meta{font-size:0.7rem;color:var(--text-secondary)}
        .food-item-quick .food-cal{font-weight:700;color:var(--warning);font-size:0.9rem;margin-left:8px}
        .food-item-quick .quick-add-btn{width:44px;height:44px;min-width:44px;min-height:44px;border-radius:50%;background:var(--primary);color:white;border:none;font-size:1.3rem;margin-left:8px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;padding:0}
        .food-item-quick .quick-add-btn:active{background:var(--primary-dark);transform:scale(0.95)}
        .form-row-3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
        .theme-toggle{display:flex;align-items:center;gap:8px;background:rgba(255,255,255,0.15);padding:6px 10px;border-radius:20px;backdrop-filter:blur(10px)}
        .theme-switch{position:relative;width:48px;height:26px;background:rgba(255,255,255,0.25);border-radius:13px;cursor:pointer;transition:all 0.3s;flex-shrink:0;border:none}
        .theme-switch::after{content:'';position:absolute;top:3px;left:3px;width:20px;height:20px;background:white;border-radius:50%;transition:transform 0.3s;box-shadow:0 2px 8px rgba(0,0,0,0.2)}
        .theme-switch.light::after{transform:translateX(22px)}
        .theme-switch.light{background:rgba(0,0,0,0.15)}
        .theme-label{font-weight:500;font-size:0.85rem;color:white;opacity:0.9}
        .celebration-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);display:flex;align-items:center;justify-content:center;z-index:9999;opacity:0;pointer-events:none;transition:opacity 0.3s}
        .celebration-overlay.active{opacity:1;pointer-events:auto}
        .celebration-content{text-align:center;animation:celebrationPop 0.5s ease-out}
        .celebration-emoji{font-size:5rem;animation:bounce 0.6s ease infinite}
        .celebration-title{font-size:2rem;font-weight:700;color:white;margin:16px 0 8px}
        .celebration-subtitle{color:var(--text-secondary);font-size:1.1rem}
        @keyframes celebrationPop{0%{transform:scale(0.5);opacity:0}50%{transform:scale(1.1)}100%{transform:scale(1);opacity:1}}
        @keyframes bounce{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}
        .onboarding-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:linear-gradient(135deg,var(--primary-dark),var(--primary));display:flex;align-items:center;justify-content:center;z-index:10000}
        .onboarding-card{background:var(--bg-card);border-radius:24px;padding:32px;max-width:400px;width:90%;text-align:center;box-shadow:0 20px 60px rgba(0,0,0,0.3)}
        .onboarding-step{display:none}
        .onboarding-step.active{display:block;animation:fadeIn 0.3s ease}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .onboarding-icon{font-size:4rem;margin-bottom:16px}
        .onboarding-title{font-size:1.5rem;font-weight:700;margin-bottom:12px}
        .onboarding-text{color:var(--text-secondary);margin-bottom:24px;line-height:1.6}
        .onboarding-dots{display:flex;justify-content:center;gap:8px;margin-bottom:24px}
        .onboarding-dot{width:8px;height:8px;border-radius:50%;background:var(--border)}
        .onboarding-dot.active{background:var(--primary);width:24px}
        .tutorial-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.95);display:none;align-items:center;justify-content:center;z-index:99999;padding:20px}
        .tutorial-overlay.active{display:flex !important}
        .tutorial-card{background:#1e293b;border-radius:24px;max-width:400px;width:100%;max-height:90vh;overflow:hidden;color:#f1f5f9}
        .tutorial-slide{display:none;animation:fadeIn 0.3s ease}
        .tutorial-slide.active{display:block !important}
        .tutorial-image{background:linear-gradient(135deg,#10b981,#059669);padding:40px 20px;text-align:center}
        .tutorial-icon{font-size:4rem;margin-bottom:12px}
        .tutorial-mockup{background:#0f172a;border-radius:12px;padding:16px;margin:0 auto;max-width:200px}
        .tutorial-content{padding:24px}
        .tutorial-title{font-size:1.3rem;font-weight:700;margin-bottom:12px;text-align:center;color:#f1f5f9}
        .tutorial-text{color:#94a3b8;font-size:0.95rem;line-height:1.6;margin-bottom:20px;text-align:center}
        .tutorial-tip{background:#334155;border-radius:10px;padding:12px;font-size:0.85rem;margin-bottom:20px;color:#f1f5f9}
        .tutorial-tip strong{color:#10b981}
        .tutorial-nav{display:flex;justify-content:space-between;align-items:center;padding:0 24px 24px}
        .tutorial-dots{display:flex;gap:6px}
        .tutorial-dot{width:8px;height:8px;border-radius:50%;background:#475569;transition:all 0.3s}
        .tutorial-dot.active{background:#10b981;width:20px}
        .tutorial-btn{padding:10px 20px;border:none;border-radius:8px;font-weight:600;cursor:pointer;font-size:0.9rem}
        .tutorial-btn.primary{background:#10b981;color:white}
        .tutorial-btn.primary:hover{background:#059669}
        .tutorial-btn.secondary{background:transparent;color:#94a3b8}
        .insight-card{background:var(--bg-input);border-radius:12px;padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px}
        .insight-icon{font-size:1.5rem}
        .insight-text{flex:1}
        .insight-title{font-weight:600;font-size:0.9rem}
        .insight-detail{font-size:0.8rem;color:var(--text-secondary)}
        @media(min-width:768px){.stats-grid{grid-template-columns:repeat(4,1fr)}.bottom-nav{top:0;bottom:auto;max-width:600px;left:50%;transform:translateX(-50%);border-radius:0 0 20px 20px;border-top:none}body{padding-top:70px;padding-bottom:20px}.header{position:relative}.modal{border-radius:20px;margin:auto}.modal-overlay{align-items:center}}
    </style>
</head>
<body>
    <a class="skip-link" href="#main-content">Skip to content</a>
    <!-- Splash Screen -->
    <div class="splash-screen" id="splash-screen">
        <div class="splash-logo"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZmZmZiIgcng9IjIwIi8+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMTBiOTgxIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzA1OTY2OSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0NiIgcj0iMzYiIGZpbGw9InVybCgjZykiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjQ2IiByPSIyOCIgZmlsbD0iI2ZmZiIvPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNDYiIHI9IjIyIiBmaWxsPSJub25lIiBzdHJva2U9IiNFNUU3RUIiIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtZGFzaGFycmF5PSIxMDQiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNTAgNDYpIi8+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0NiIgcj0iMjIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzEwYjk4MSIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1kYXNoYXJyYXk9IjEwNCIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjI5IiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNTAgNDYpIi8+CiAgPHRleHQgeD0iNTAiIHk9IjQ0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMUUyOTNCIj4xLDQ4MDwvdGV4dD4KICA8dGV4dCB4PSI1MCIgeT0iNTMiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZiIgZm9udC1zaXplPSI1IiBmaWxsPSIjNjQ3NDhCIj5rY2FsPC90ZXh0PgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iI0VGNDQ0NCIvPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iIzNCODJGNiIvPgogIDxjaXJjbGUgY3g9IjYwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iI0Y1OUUwQiIvPgogIDx0ZXh0IHg9IjQwIiB5PSI2My4yIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmb250LXNpemU9IjIuNSIgZmlsbD0iI2ZmZiI+UDwvdGV4dD4KICA8dGV4dCB4PSI1MCIgeT0iNjMuMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zaXplPSIyLjUiIGZpbGw9IiNmZmYiPkM8L3RleHQ+CiAgPHRleHQgeD0iNjAiIHk9IjYzLjIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMi41IiBmaWxsPSIjZmZmIj5GPC90ZXh0PgogIDx0ZXh0IHg9IjUwIiB5PSI5MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zaXplPSI4IiBmaWxsPSIjMDU5NjY5Ij5DYWxvcmllUHJvPC90ZXh0Pgo8L3N2Zz4K" alt="CaloriePro Logo" style="width:80px;height:80px;display:block;margin:16px auto;"></div>
        <div class="splash-title">CaloriePro</div>
        <div class="splash-subtitle">Your Personal Nutrition Tracker</div>
        <div class="splash-loader"></div>
    </div>
    
    
    <main class="main-content" id="main-content">
        <div id="page-dashboard" class="page active"><div id="pull-indicator" class="pull-indicator"><span class="pull-spinner">‚Üª</span> <span id="pull-text">‚Üì Pull to refresh</span></div>
            <div class="card" style="margin-top:calc(env(safe-area-inset-top,0px) - 4px);margin-bottom:16px;padding:16px 20px;">
                <div style="display:flex;align-items:center;justify-content:space-between;">
                    <div>
                        <div id="greeting-text" style="font-size:1.15rem;font-weight:700;"></div>
                        <div id="greeting-nudge" style="font-size:0.8rem;color:var(--text-secondary);margin-top:2px;"></div>
                    </div>
                    <div class="theme-toggle">
                        <span class="theme-label" aria-hidden="true">üåô</span>
                        <button class="theme-switch" id="theme-switch" onclick="toggleTheme()" aria-label="Toggle dark/light mode" role="switch"></button>
                        <span class="theme-label" aria-hidden="true">‚òÄÔ∏è</span>
                    </div>
                </div>
            </div>
            <div id="viewing-past-banner" class="viewing-past" style="display:none;">
                <span class="viewing-past-text">üìÖ Viewing past date</span>
                <button class="viewing-past-btn" onclick="goToToday()" aria-label="Return to today">Go to Today</button>
            </div>
            <div id="streak-recovery-banner"></div>
            <div class="date-nav" id="date-nav">
                <button class="date-nav-btn" onclick="changeDate(-1)" aria-label="Previous day">‚Äπ</button>
                <div class="date-nav-current">
                    <div id="current-date-display">Today</div>
                    <div class="date-nav-sub" id="current-date-full"></div>
                </div>
                <button class="date-nav-btn" onclick="changeDate(1)" id="next-day-btn" aria-label="Next day">‚Ä∫</button>
            </div>
            <div class="card">
                <div class="progress-container">
                    <div class="progress-ring" role="progressbar" aria-label="Daily calorie progress" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" id="calorie-ring-container">
                        <svg width="160" height="160"><circle class="bg" cx="80" cy="80" r="68"></circle><circle class="progress" id="calorie-progress" cx="80" cy="80" r="68" stroke-dasharray="427" stroke-dashoffset="427"></circle></svg>
                        <div class="progress-text"><div class="value" id="calories-remaining-ring">0</div><div class="label" id="calories-ring-label">remaining</div><div style="font-size:0.7rem;color:var(--text-secondary);margin-top:2px;" id="calories-eaten-sub">0 of <span id="calories-target">2000</span> eaten</div></div>
                    </div>
                </div>
                <div class="macro-rings">
                    <div class="macro-ring" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                        <svg width="80" height="80"><circle class="bg" cx="40" cy="40" r="32"></circle><circle class="progress" id="protein-ring" cx="40" cy="40" r="32" stroke-dasharray="201" stroke-dashoffset="201" style="stroke:var(--danger)"></circle></svg>
                        <div class="macro-ring-label"><div class="macro-ring-value" id="protein-ring-value">0g</div><div class="macro-ring-name">Protein</div></div>
                    </div>
                    <div class="macro-ring" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                        <svg width="80" height="80"><circle class="bg" cx="40" cy="40" r="32"></circle><circle class="progress" id="carbs-ring" cx="40" cy="40" r="32" stroke-dasharray="201" stroke-dashoffset="201" style="stroke:var(--secondary)"></circle></svg>
                        <div class="macro-ring-label"><div class="macro-ring-value" id="carbs-ring-value">0g</div><div class="macro-ring-name">Carbs</div></div>
                    </div>
                    <div class="macro-ring" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                        <svg width="80" height="80"><circle class="bg" cx="40" cy="40" r="32"></circle><circle class="progress" id="fat-ring" cx="40" cy="40" r="32" stroke-dasharray="201" stroke-dashoffset="201" style="stroke:var(--purple)"></circle></svg>
                        <div class="macro-ring-label"><div class="macro-ring-value" id="fat-ring-value">0g</div><div class="macro-ring-name">Fat</div></div>
                    </div>
                    <div class="macro-ring" role="progressbar" aria-valuemin="0" aria-valuemax="100">
                        <svg width="80" height="80"><circle class="bg" cx="40" cy="40" r="32"></circle><circle class="progress" id="water-ring" cx="40" cy="40" r="32" stroke-dasharray="201" stroke-dashoffset="201" style="stroke:var(--secondary)"></circle></svg>
                        <div class="macro-ring-label"><div class="macro-ring-value" id="water-ring-value">0</div><div class="macro-ring-name">Water</div></div>
                    </div>
                </div>
                <div id="calorie-summary" style="margin-top:12px;padding:12px;background:var(--bg-input);border-radius:12px;">
                    <div style="display:flex;justify-content:space-around;text-align:center;margin-bottom:8px;">
                        <div><div style="font-size:1.2rem;font-weight:700;color:var(--primary);" id="cal-remaining">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Remaining</div></div>
                        <div style="width:1px;background:var(--border);"></div>
                        <div><div style="font-size:1.2rem;font-weight:700;color:var(--warning);" id="cal-eaten">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Eaten</div></div>
                        <div style="width:1px;background:var(--border);"></div>
                        <div><div style="font-size:1.2rem;font-weight:700;color:var(--danger);" id="cal-burned">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Burned</div></div>
                        <div style="width:1px;background:var(--border);"></div>
                        <div><div style="font-size:1.2rem;font-weight:700;color:var(--secondary);" id="cal-net">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Net</div></div>
                    </div>
                    <div id="meal-breakdown" style="display:flex;justify-content:space-around;text-align:center;padding-top:8px;border-top:1px solid var(--border);"></div>
                </div>
                <div style="display:flex;gap:8px;margin-top:10px;">
                    <div id="streak-badge" style="display:none;flex:1;text-align:center;padding:8px;background:linear-gradient(135deg,rgba(245,158,11,0.15),rgba(239,68,68,0.1));border-radius:10px;">
                        <span style="font-size:0.85rem;">üî• <strong id="streak-count">0</strong> day streak</span>
                    </div>
                    <div id="level-badge-container" style="flex:1;text-align:center;padding:8px;background:linear-gradient(135deg,rgba(245,158,11,0.1),rgba(139,92,246,0.1));border-radius:10px;">
                        <span id="level-display" style="font-size:0.85rem;">‚≠ê Level 1</span>
                        <div style="width:80%;height:4px;background:var(--bg-card);border-radius:2px;margin:4px auto 0;overflow:hidden;"><div id="xp-bar-fill" style="height:100%;background:var(--warning);border-radius:2px;width:0%;transition:width 0.5s;"></div></div>
                        <div id="xp-text" style="font-size:0.6rem;color:var(--text-secondary);margin-top:2px;">0 / 100 XP</div>
                    </div>
                </div>
                <div id="mini-week-chart" class="mini-chart" style="margin-bottom:4px;"></div>
            </div>
            <div class="card">
                <h3 class="card-title">‚ö° Quick Add</h3>
                <div id="favorites-quick" style="margin-bottom:8px;"></div>
                <div class="quick-add" id="smart-tiles">
                    <!-- Smart tiles populated by JS -->
                </div>
            </div>
            <div class="card" id="build-meal-promo" style="background:linear-gradient(135deg,rgba(59,130,246,0.15),rgba(139,92,246,0.1));border:1px solid rgba(59,130,246,0.2);">
                <div style="display:flex;align-items:center;gap:12px;">
                    <div style="font-size:2rem;">üçΩÔ∏è</div>
                    <div style="flex:1;">
                        <div style="font-weight:600;font-size:0.9rem;">Build a Meal</div>
                        <div style="font-size:0.75rem;color:var(--text-secondary);margin-top:2px;">Combine foods into one meal ‚Äî log everything in one tap</div>
                    </div>
                    <button class="btn btn-secondary btn-sm" onclick="haptic('medium');openModal('add-meal-modal');setTimeout(()=>switchAddTab('build'),100)" style="width:auto;white-space:nowrap;padding:8px 14px;">+ Build</button>
                </div>
                <div id="saved-meals-chips" style="margin-top:8px;"></div>
            </div>
            <div class="card">
                <h3 class="section-title" id="meals-title" style="text-align:center;margin-bottom:12px;">üìã Today's Meals</h3>
                <div style="display:flex;gap:8px;margin-bottom:12px;">
                    <button class="btn btn-primary" onclick="openModal('add-meal-modal')" style="flex:1;">+ Add Meal</button>
                    <button class="btn btn-outline btn-sm" id="dash-clear-btn" onclick="showDashClearOptions(this)" style="width:auto;padding:8px 12px;font-size:0.75rem;">‚ãØ</button>
                </div>
                <div id="todays-meals-list"><div class="empty-state"><div class="empty-state-icon">üöÄ</div><p style="font-weight:600;">Your food journey starts here!</p><p style="font-size:0.8rem;margin-top:8px;color:var(--text-secondary);">Tap the green + button to log your first meal</p></div></div>
            </div>
            <div class="card">
                <h3 class="section-title" style="text-align:center;margin-bottom:12px;">üèÉ Exercise</h3>
                <div id="dashboard-exercise-summary"></div>
                <div id="exercise-week-chart-container" style="margin-top:4px;"></div>
                <div id="dashboard-exercise-list" style="margin-top:8px;"></div>
                <button class="btn btn-primary btn-sm" onclick="openExerciseModal()" style="width:100%;margin-top:10px;">+ Log Exercise</button>
            </div>
            <div class="card">
                <div class="section-header"><h3 class="section-title">üíß Water Intake</h3><span style="font-size:0.7rem;color:var(--text-secondary);margin-right:auto;margin-left:8px;">(250ml per glass)</span><span id="water-count" style="font-size:1.2rem;font-weight:700;color:var(--secondary);">0 / 8</span></div>
                <div class="water-tracker"><div class="water-glasses" id="water-glasses"></div><div class="btn-group" style="margin-top:8px;"><button class="btn btn-secondary btn-sm" onclick="addWater()">+ Add Glass</button><button class="btn btn-outline btn-sm" onclick="removeWater()">- Remove</button></div></div>
            </div>
            <div class="card" style="padding:12px;">
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;"><span style="font-size:0.85rem;">üìù</span><span style="font-size:0.8rem;font-weight:600;">Quick Note</span></div>
                <textarea class="form-input" id="dashboard-daily-note" placeholder="How's your day going? Energy, sleep, cravings..." rows="1" onchange="saveDashboardNote()" onfocus="this.rows=3" onblur="if(!this.value)this.rows=1" style="font-size:0.8rem;padding:8px 10px;resize:none;"></textarea>
            </div>
            <div class="card collapsible-card">
                <div class="collapsible-header" onclick="toggleCollapse(this)">
                    <h3 class="card-title" style="margin-bottom:0;">üìä Today's Insights</h3>
                    <span class="collapse-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div id="daily-insights"></div>
                </div>
            </div>
            <div class="card" id="challenges-card">
                <h3 class="card-title">üéØ Weekly Challenges</h3>
                <div id="weekly-challenges"></div>
            </div>
            <div class="card collapsible-card">
                <div class="collapsible-header" onclick="toggleCollapse(this)">
                    <h3 class="card-title" style="margin-bottom:0;">üìÖ Weekly Summary</h3>
                    <span class="collapse-icon">‚ñæ</span>
                </div>
                <div class="collapsible-body">
                    <div id="weekly-summary"></div>
                </div>
            </div>
        </div>
        <div id="page-log" class="page">
            <div class="card">
                <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;">
                    <button class="icon-btn add" onclick="changeCalendarMonth(-1)" style="width:36px;height:36px;min-width:36px;min-height:36px;background:var(--bg-input);">‚Äπ</button>
                    <h3 class="card-title" id="calendar-month-label" style="margin-bottom:0;">üìÖ This Month</h3>
                    <button class="icon-btn add" onclick="changeCalendarMonth(1)" style="width:36px;height:36px;min-width:36px;min-height:36px;background:var(--bg-input);">‚Ä∫</button>
                </div>
                <div id="calendar-view" class="calendar-grid"></div>
                <div id="calendar-stats" style="margin-top:10px;text-align:center;font-size:0.8rem;color:var(--text-secondary);"></div>
                <div id="calendar-copy-action" style="display:none;text-align:center;margin-top:8px;"></div>
            </div>
            <div class="card">
                <h3 class="card-title">üçΩÔ∏è Log Meal</h3>
                <div class="section-header" style="margin-bottom:8px;"><span class="section-title" style="font-size:0.85rem;">üïê Recent Foods</span></div>
                <div id="recent-foods" class="recent-foods-row"></div>
                <div class="meal-tabs" id="meal-tabs"><button class="meal-tab active" data-meal="Breakfast">üåÖ Breakfast</button><button class="meal-tab" data-meal="Lunch">‚òÄÔ∏è Lunch</button><button class="meal-tab" data-meal="Dinner">üåô Dinner</button><button class="meal-tab" data-meal="Snack">üçø Snack</button></div>
                <div class="search-box"><input type="text" class="form-input" id="food-search" placeholder="Search 5,000+ foods..." oninput="debouncedFilterFoods()"></div>
                <div class="category-tabs" id="category-tabs"><button class="category-tab active" data-category="All">All</button><button class="category-tab" data-category="Proteins">Protein</button><button class="category-tab" data-category="Carbs">Carbs</button><button class="category-tab" data-category="Vegetables,Fruits">Veg & Fruit</button><button class="category-tab" data-category="Dairy">Dairy</button><button class="category-tab" data-category="Snacks,Desserts,Bakery">Snacks</button><button class="category-tab" data-category="Beverages,Coffee Shops">Drinks</button><button class="category-tab" data-category="Breakfast">Breakfast</button><button class="category-tab" data-category="Fast Food,Restaurants,Coffee Shops">Eating Out</button><button class="category-tab" data-category="Ready Meals,Meal Kits">Ready Meals</button><button class="category-tab" data-category="Home Cooked,International">Home Cooked</button><button class="category-tab" data-category="Branded">Branded</button><button class="category-tab" data-category="Condiments,Ingredients,Kids,Other">Other</button></div>
                <div id="food-select-list" class="scrollable-list" style="margin-bottom:12px;"></div>
                <button class="btn btn-warning" onclick="openScannerModal()" style="width:100%;">üì∑ Scan Barcode</button>
            </div>
            <div class="card">
                <h3 class="section-title" style="text-align:center;margin-bottom:12px;">üç≥ Meal Templates</h3>
                <button class="btn btn-primary" onclick="openModal('template-modal')" style="width:100%;margin-bottom:16px;">+ Create Template</button>
                <div id="templates-list"></div>
            </div>
            <div class="card">
                <h3 class="section-title" style="text-align:center;margin-bottom:12px;">‚öñÔ∏è Log Weight</h3>
                <button class="btn btn-primary" onclick="openModal('weight-modal')" style="width:100%;">+ Log Weight</button>
            </div>
            <div class="card">
                <h3 class="section-title" style="text-align:center;margin-bottom:12px;">üèÉ Log Exercise</h3>
                <button class="btn btn-primary" onclick="openExerciseModal()" style="width:100%;margin-bottom:12px;">+ Log Exercise</button>
                <div id="log-page-exercise-list"></div>
            </div>
            <div class="card">
                <div class="section-header"><h3 class="section-title">üòä How Are You Feeling?</h3><span id="current-mood-display" class="mood-display"></span></div>
                <div class="mood-selector" id="mood-selector">
                    <div style="text-align:center"><button class="mood-btn" data-mood="1" onclick="selectMood(1)">üò¢</button><div class="mood-label">Awful</div></div>
                    <div style="text-align:center"><button class="mood-btn" data-mood="2" onclick="selectMood(2)">üòî</button><div class="mood-label">Bad</div></div>
                    <div style="text-align:center"><button class="mood-btn" data-mood="3" onclick="selectMood(3)">üòê</button><div class="mood-label">Okay</div></div>
                    <div style="text-align:center"><button class="mood-btn" data-mood="4" onclick="selectMood(4)">üòä</button><div class="mood-label">Good</div></div>
                    <div style="text-align:center"><button class="mood-btn" data-mood="5" onclick="selectMood(5)">üòÑ</button><div class="mood-label">Great</div></div>
                </div>
                <textarea class="form-input" id="daily-note" placeholder="Any notes about today? How did you sleep? Energy levels?" rows="2" onchange="saveDailyNote()"></textarea>
            </div>
            <div class="card">
                <div style="display:flex;gap:8px;">
                    <button class="btn btn-danger btn-sm" onclick="clearTodaysFood()" style="flex:1;font-size:0.7rem;">üóëÔ∏è Clear Food</button>
                    <button class="btn btn-danger btn-sm" onclick="clearTodaysExercise()" style="flex:1;font-size:0.7rem;">üóëÔ∏è Clear Exercise</button>
                    <button class="btn btn-danger btn-sm" onclick="clearTodaysAll()" style="flex:1;font-size:0.7rem;">üóëÔ∏è Clear All</button>
                </div>
            </div>
        </div>
        <div id="page-foods" class="page">
            <div class="card">
                <h3 class="section-title" style="text-align:center;margin-bottom:12px;">ü•ó Food Database</h3>
                <button class="btn btn-primary" onclick="openModal('add-food-modal')" style="width:100%;margin-bottom:16px;">+ Add Food</button>
                <div class="search-box"><input type="text" class="form-input" id="food-db-search" placeholder="Search 5,000+ foods..." oninput="debouncedFilterFoodDatabase()"></div>
                <div class="btn-group" style="margin-bottom:12px;"><button class="btn btn-warning btn-sm" onclick="openScannerModal()">üì∑ Scan Barcode</button><button class="btn btn-secondary btn-sm" onclick="openModal('add-food-modal')">+ Add Custom</button></div>
                <div id="food-categories" style="margin-bottom:12px;"></div>
                <div id="food-list" class="scrollable-list"></div>
            </div>
        </div>
        <div id="page-reports" class="page">
            <div class="card">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                    <h3 class="card-title" style="margin:0;">üìà Calorie Trend</h3>
                    <select class="form-select" id="trend-range" onchange="refreshCalorieTrend()" style="width:auto;padding:4px 8px;font-size:0.7rem;">
                        <option value="7">7 days</option>
                        <option value="14" selected>14 days</option>
                        <option value="30">30 days</option>
                    </select>
                </div>
                <div class="trend-chart"><canvas id="calorie-trend-canvas"></canvas></div>
                <div class="trend-legend">
                    <span><span class="dot" style="background:var(--primary);"></span> Calories</span>
                    <span><span class="dot" style="background:var(--danger);"></span> Burned</span>
                    <span><span class="dot" style="background:var(--border);"></span> Target</span>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">ü•ß Macro Breakdown</h3>
                <p style="font-size:0.7rem;color:var(--text-secondary);margin-bottom:8px;">Average daily macros over last 7 days</p>
                <div class="macro-pie-wrap">
                    <canvas id="macro-pie-canvas" width="100" height="100"></canvas>
                    <div class="macro-pie-legend" id="macro-pie-legend"></div>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">üèãÔ∏è Body Stats</h3>
                <div class="body-stats-grid" id="body-stats-grid"></div>
            </div>
            <div class="card">
                <h3 class="section-title" style="text-align:center;margin-bottom:12px;">‚öñÔ∏è Weight Progress</h3>
                <div id="weight-chart-container"></div>
                <div id="weight-stats" style="margin-top:10px;"></div>
                <div id="weight-projection"></div>
                <div id="progress-photos-gallery"></div>
            </div>
            <div class="card"><h3 class="card-title">üìä Weekly Overview</h3><div class="week-chart" id="week-chart"></div><div class="stats-grid" style="margin-top:10px;"><div class="stat-card"><div class="stat-value" id="week-avg-cal">0</div><div class="stat-label">Avg Cal/Day</div></div><div class="stat-card"><div class="stat-value" id="week-total-cal">0</div><div class="stat-label">Week Total</div></div></div></div>
            <div class="card">
                <h3 class="card-title">üèãÔ∏è Exercise Summary</h3>
                <div id="exercise-report"></div>
            </div>
            <div class="card">
                <h3 class="card-title">üòä Mood Tracker</h3>
                <p style="font-size:0.8rem;color:var(--text-secondary);margin-bottom:12px;">Your mood over the last 30 days</p>
                <div id="mood-report"></div>
            </div>
            <div class="card"><h3 class="card-title">‚öñÔ∏è BMI Analysis</h3><div id="bmi-report"></div></div>
            <div class="card"><h3 class="card-title">üí° Insights & Recommendations</h3><div id="insights-container"></div></div>
            <div class="card"><h3 class="card-title">üéØ Goal Progress</h3><div id="goal-progress"></div></div>
            <div class="card"><h3 class="card-title">ü•ó Macro Balance</h3><div id="macro-report"></div></div>
            <div class="card">
                <h3 class="card-title">üì§ Share & Export</h3>
                <p style="font-size:0.8rem;color:var(--text-secondary);margin-bottom:12px;">Share your progress or download your data</p>
                <div class="btn-group">
                    <button class="btn btn-primary btn-sm" onclick="shareDaySummary()">üì± Share Today</button>
                    <button class="btn btn-secondary btn-sm" onclick="shareAchievements()">üèÜ Share Badges</button>
                </div>
                <div class="btn-group" style="margin-top:8px;">
                    <button class="btn btn-primary" onclick="openExportModal()">üìä Export Report</button>
                </div>
            </div>
        </div>
        <div id="page-profile" class="page">
            <div class="card" style="text-align:center;padding:20px;">
                <div style="font-size:3rem;" id="profile-avatar-icon">üë§</div>
                <div style="font-size:1.2rem;font-weight:700;margin-top:4px;" id="profile-display-name">CaloriePro User</div>
                <div id="profile-level-badge" style="font-size:0.8rem;color:var(--warning);margin-top:4px;"></div>
                <div style="display:flex;justify-content:center;gap:20px;margin-top:12px;">
                    <div style="text-align:center;"><div style="font-size:1.1rem;font-weight:700;" id="profile-stat-streak">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Streak</div></div>
                    <div style="text-align:center;"><div style="font-size:1.1rem;font-weight:700;" id="profile-stat-meals">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Meals</div></div>
                    <div style="text-align:center;"><div style="font-size:1.1rem;font-weight:700;" id="profile-stat-days">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Days</div></div>
                    <div style="text-align:center;"><div style="font-size:1.1rem;font-weight:700;" id="profile-stat-badges">0</div><div style="font-size:0.65rem;color:var(--text-secondary);">Badges</div></div>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">üë§ Personal Details</h3>
                <div class="form-group"><label class="form-label">Name</label><input type="text" class="form-input" id="profile-name" placeholder="Your name"></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Age</label><input type="number" class="form-input" id="profile-age" placeholder="25"></div><div class="form-group"><label class="form-label">Gender</label><select class="form-select" id="profile-gender"><option value="Male">Male</option><option value="Female">Female</option></select></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Height (cm)</label><input type="number" class="form-input" id="profile-height" placeholder="175"></div><div class="form-group"><label class="form-label">Weight (kg)</label><input type="number" class="form-input" id="profile-weight" placeholder="70"></div></div>
                <div class="form-row"><div class="form-group"><label class="form-label">Activity</label><select class="form-select" id="profile-activity"><option value="Sedentary">Sedentary</option><option value="Light">Light</option><option value="Moderate" selected>Moderate</option><option value="Active">Active</option><option value="Very Active">Very Active</option></select></div><div class="form-group"><label class="form-label">Goal</label><select class="form-select" id="profile-goal"><option value="Lose">Lose Weight</option><option value="Maintain" selected>Maintain</option><option value="Gain">Gain Weight</option></select></div></div>
                <div class="form-group"><label class="form-label">Goal Weight (kg)</label><input type="number" class="form-input" id="profile-goal-weight" step="0.1" placeholder="e.g. 80"></div>
                <button class="btn btn-primary" onclick="saveProfile()">üíæ Save Profile</button>
                <div class="bmi-result" id="bmi-result" style="display:none;"><div class="bmi-value" id="bmi-value">0</div><div class="bmi-category" id="bmi-category">-</div><div class="bmi-target" id="daily-target">Daily Target: 2000 cal</div></div>
            </div>
            <div class="card">
                <h3 class="card-title">üéØ Nutrition Targets</h3>
                <p style="font-size:0.75rem;color:var(--text-secondary);margin-bottom:10px;">Set specific daily targets (leave blank for auto)</p>
                <div class="form-row-3">
                    <div class="form-group"><label class="form-label">Protein (g)</label><input type="number" class="form-input" id="target-protein" placeholder="Auto"></div>
                    <div class="form-group"><label class="form-label">Carbs (g)</label><input type="number" class="form-input" id="target-carbs" placeholder="Auto"></div>
                    <div class="form-group"><label class="form-label">Fat (g)</label><input type="number" class="form-input" id="target-fat" placeholder="Auto"></div>
                </div>
                <div class="form-group"><label class="form-label">Water Goal (glasses)</label><input type="number" class="form-input" id="target-water" value="7" min="1" max="20"></div>
                <button class="btn btn-secondary" onclick="saveMacroTargets()">Save Targets</button>
            </div>
            <div class="card">
                <h3 class="card-title">‚öôÔ∏è Preferences</h3>
                <div class="settings-section">
                    <div class="settings-row" style="flex-direction:column;align-items:stretch;">
                        <div class="sr-left" style="margin-bottom:8px;"><span class="sr-icon">üé®</span><div><div class="sr-text">Appearance</div><div class="sr-sub">Choose your theme</div></div></div>
                        <div class="theme-selector" id="theme-selector">
                            <div class="theme-opt" data-theme="auto" onclick="setThemePref('auto')"><span class="theme-opt-icon">üì±</span>Auto</div>
                            <div class="theme-opt" data-theme="dark" onclick="setThemePref('dark')"><span class="theme-opt-icon">üåô</span>Dark</div>
                            <div class="theme-opt" data-theme="light" onclick="setThemePref('light')"><span class="theme-opt-icon">‚òÄÔ∏è</span>Light</div>
                        </div>
                    </div>
                    <div class="settings-row">
                        <div class="sr-left"><span class="sr-icon">üîî</span><div><div class="sr-text">Meal Reminders</div><div class="sr-sub">Prompt at breakfast, lunch & dinner</div></div></div>
                        <label class="toggle"><input type="checkbox" id="pref-reminders" onchange="savePreferences()"><span class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <div class="sr-left"><span class="sr-icon">üì≥</span><div><div class="sr-text">Haptic Feedback</div><div class="sr-sub">Vibrate on tap actions</div></div></div>
                        <label class="toggle"><input type="checkbox" id="pref-haptic" checked onchange="savePreferences()"><span class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <div class="sr-left"><span class="sr-icon">üéâ</span><div><div class="sr-text">Celebrations</div><div class="sr-sub">Confetti on achievements & milestones</div></div></div>
                        <label class="toggle"><input type="checkbox" id="pref-celebrations" checked onchange="savePreferences()"><span class="slider"></span></label>
                    </div>
                    <div class="settings-row">
                        <div class="sr-left"><span class="sr-icon">üí°</span><div><div class="sr-text">Smart Suggestions</div><div class="sr-sub">Food suggestions based on your history</div></div></div>
                        <label class="toggle"><input type="checkbox" id="pref-suggestions" checked onchange="savePreferences()"><span class="slider"></span></label>
                    </div>
                </div>
            </div>
            <div class="card">
                <h3 class="card-title">üèÜ Achievements</h3>
                <div id="achievements-list" class="achievements-grid"></div>
            </div>
            <div class="card"><h3 class="card-title">üîß Data & Support</h3><div class="btn-group"><button class="btn btn-primary btn-sm" onclick="quickBackupToFiles()">‚òÅÔ∏è Backup to Files</button><button class="btn btn-outline btn-sm" onclick="importData()">üì• Restore</button></div><div class="btn-group" style="margin-top:6px;"><button class="btn btn-secondary btn-sm" onclick="openExportModal()">üì§ Export Report</button><button class="btn btn-outline btn-sm" onclick="showTutorial()">üìñ Tutorial</button></div><div class="btn-group" style="margin-top:6px;"><button class="btn btn-outline btn-sm" onclick="openFeedbackModal()">üí¨ Send Feedback</button><button class="btn btn-danger btn-sm" onclick="clearAllData()">üóëÔ∏è Reset App</button></div><div class="privacy-notice">üîí <strong>100% Private:</strong> All data stored locally only. Backup saves to your device's Files app.</div></div>
            <div class="card"><h3 class="card-title">üìÑ Legal & Support</h3><div class="btn-group"><a href="privacy.html" class="btn btn-outline btn-sm" style="text-decoration:none;">üîí Privacy</a><a href="terms.html" class="btn btn-outline btn-sm" style="text-decoration:none;">üìã Terms</a></div><div class="btn-group" style="margin-top:8px;"><button class="btn btn-outline btn-sm" onclick="openFeedbackModal()">üí¨ Send Feedback</button><button class="btn btn-outline btn-sm" onclick="showWhatsNew()">‚ú® What's New</button></div><div class="btn-group" style="margin-top:8px;"><button class="btn btn-primary btn-sm" onclick="shareApp()">üì§ Share CaloriePro</button><button class="btn btn-outline btn-sm" onclick="rateApp()">‚≠ê Rate App</button></div><div style="text-align:center;margin-top:12px;font-size:0.75rem;color:var(--text-secondary);">CaloriePro v1<br>Made with ‚ù§Ô∏è in the UK</div></div>
        </div>
    </main>
    <button class="fab" onclick="haptic('medium');openModal('add-meal-modal')" aria-label="Quick add food">+</button>
    <nav class="bottom-nav" role="navigation" aria-label="Main navigation"><button class="nav-item active" data-page="dashboard" aria-label="Home dashboard" role="tab" aria-selected="true"><span aria-hidden="true">üè†</span><span>Home</span></button><button class="nav-item" data-page="log" aria-label="Log food and exercise" role="tab"><span aria-hidden="true">‚ûï</span><span>Log</span></button><button class="nav-item" data-page="foods" aria-label="Food database" role="tab"><span aria-hidden="true">ü•ó</span><span>Foods</span></button><button class="nav-item" data-page="reports" aria-label="Reports and statistics" role="tab"><span aria-hidden="true">üìä</span><span>Reports</span></button><button class="nav-item" data-page="profile" aria-label="Profile settings" role="tab"><span aria-hidden="true">üë§</span><span>Profile</span></button></nav>
    <div class="modal-overlay" id="add-meal-modal"><div class="modal" style="max-height:95vh;min-height:50vh;overflow:hidden;display:flex;flex-direction:column;"><div class="modal-header"><h3 class="modal-title">‚ûï Add Food</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('add-meal-modal')">‚úï</button></div><div id="modal-recent-chips" style="margin-bottom:10px;"></div><div class="btn-group" style="margin-bottom:12px;"><button class="btn btn-primary btn-sm" id="tab-search" onclick="switchAddTab('search')">üîç Search</button><button class="btn btn-outline btn-sm" id="tab-manual" onclick="switchAddTab('manual')">‚úèÔ∏è Manual</button><button class="btn btn-outline btn-sm" id="tab-build" onclick="switchAddTab('build')">üçΩÔ∏è Build Meal</button><button class="btn btn-warning btn-sm" onclick="closeModal('add-meal-modal');openScannerModal()">üì∑ Scan</button></div><div id="add-tab-search" style="flex:1;display:flex;flex-direction:column;overflow:hidden;"><div class="form-group"><select class="form-select" id="add-meal-type" style="margin-bottom:8px;"><option>üåÖ Breakfast</option><option>‚òÄÔ∏è Lunch</option><option>üåô Dinner</option><option selected>üçé Snack</option></select></div><input type="text" class="form-input" id="add-food-search" placeholder="Search 5,000+ foods..." oninput="debouncedFilterAddFoods()" style="margin-bottom:8px;"><div id="add-food-results" class="scrollable-list" style="flex:1;overflow-y:auto;max-height:none;"></div></div><div id="add-tab-manual" style="display:none;"><div class="form-group"><label class="form-label">Food Name</label><input type="text" class="form-input" id="quick-food-name" placeholder="What did you eat?"></div><div class="form-row"><div class="form-group"><label class="form-label">Calories</label><input type="number" class="form-input" id="quick-calories" placeholder="200"></div><div class="form-group"><label class="form-label">Meal</label><select class="form-select" id="quick-meal-type"><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option selected>Snack</option></select></div></div><div class="form-row-3"><div class="form-group"><label class="form-label">Protein</label><input type="number" class="form-input" id="quick-protein" value="0"></div><div class="form-group"><label class="form-label">Carbs</label><input type="number" class="form-input" id="quick-carbs" value="0"></div><div class="form-group"><label class="form-label">Fat</label><input type="number" class="form-input" id="quick-fat" value="0"></div></div><button class="btn btn-primary" onclick="quickAddFromModal()">Add to Log</button></div><div id="add-tab-build" style="display:none;"><div style="background:linear-gradient(135deg,rgba(59,130,246,0.1),rgba(139,92,246,0.05));border-radius:10px;padding:10px 12px;margin-bottom:10px;font-size:0.75rem;color:var(--text-secondary);"><strong style="color:var(--secondary);">üçΩÔ∏è Build a Meal:</strong> Combine multiple foods into one entry. Great for recipes and combos you eat regularly.</div><div id="build-saved-list" style="margin-bottom:8px;"></div><div class="form-row"><div class="form-group"><label class="form-label">Meal Name</label><input type="text" class="form-input" id="build-meal-name" placeholder="e.g. Chicken & Rice Dinner"></div><div class="form-group"><label class="form-label">Meal Type</label><select class="form-select" id="build-meal-type"><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option selected>Snack</option></select></div></div><input type="text" class="form-input" id="build-food-search" placeholder="Search to add ingredients..." oninput="debouncedFilterBuildFoods()" style="margin-bottom:8px;"><div id="build-search-results" class="scrollable-list" style="max-height:120px;margin-bottom:8px;"></div><div id="build-ingredients-list" style="margin-bottom:8px;"></div><div id="build-totals" style="text-align:center;padding:10px;background:var(--bg-input);border-radius:8px;margin-bottom:10px;"><span style="color:var(--text-secondary);font-size:0.8rem;">Add ingredients above to build your meal</span></div><div class="btn-group"><button class="btn btn-primary" onclick="logBuiltMeal()">Log Combined Meal</button><button class="btn btn-outline btn-sm" onclick="saveBuiltAsTemplate()">üíæ Save as Template</button></div></div></div></div>
    <div class="modal-overlay" id="add-food-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">Add to Database</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('add-food-modal')">‚úï</button></div><div class="form-group"><label class="form-label">Food Name</label><input type="text" class="form-input" id="new-food-name" placeholder="e.g. Chicken Breast"></div><div class="form-row"><div class="form-group"><label class="form-label">Calories</label><input type="number" class="form-input" id="new-food-calories" placeholder="165"></div><div class="form-group"><label class="form-label">Category</label><select class="form-select" id="new-food-category"><option>Proteins</option><option>Carbs</option><option>Vegetables</option><option>Fruits</option><option>Dairy</option><option>Snacks</option><option>Beverages</option><option>Breakfast</option><option>Fast Food</option><option>Restaurants</option><option>Coffee Shops</option><option>Meal Kits</option><option>Ready Meals</option><option>Branded</option><option>Home Cooked</option><option>International</option><option>Condiments</option><option>Desserts</option><option>Ingredients</option><option>Bakery</option><option>Kids</option><option>Other</option></select></div></div><div class="form-row-3"><div class="form-group"><label class="form-label">Protein</label><input type="number" class="form-input" id="new-food-protein" step="0.1"></div><div class="form-group"><label class="form-label">Carbs</label><input type="number" class="form-input" id="new-food-carbs" step="0.1"></div><div class="form-group"><label class="form-label">Fat</label><input type="number" class="form-input" id="new-food-fat" step="0.1"></div></div><button class="btn btn-primary" onclick="addFoodFromModal()">Add to Database</button></div></div>
    <div class="modal-overlay" id="quantity-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="qty-food-name">Add Food</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('quantity-modal')">‚úï</button></div><div id="qty-serving-info" style="text-align:center;font-size:0.8rem;color:var(--text-secondary);margin-bottom:8px;">Per 100g</div><div style="display:flex;gap:6px;flex-wrap:wrap;justify-content:center;margin-bottom:12px;" id="qty-portion-btns"><button class="portion-btn" onclick="setPortionQty(0.25)">¬º</button><button class="portion-btn" onclick="setPortionQty(0.5)">¬Ω</button><button class="portion-btn" onclick="setPortionQty(0.75)">¬æ</button><button class="portion-btn active" onclick="setPortionQty(1)">1</button><button class="portion-btn" onclick="setPortionQty(1.5)">1¬Ω</button><button class="portion-btn" onclick="setPortionQty(2)">2</button><button class="portion-btn" onclick="setPortionQty(3)">3</button></div><div class="form-group"><label class="form-label">Amount</label><div style="display:flex;gap:8px;"><input type="number" class="form-input" id="qty-input" value="1" min="0.1" max="50" step="0.1" style="flex:1;"><select class="form-select" id="qty-unit" style="width:auto;min-width:80px;" onchange="updateQtyFromUnit()"><option value="serving">servings</option><option value="g">grams (g)</option><option value="oz">ounces (oz)</option><option value="cup">cups</option><option value="tbsp">tablespoon</option><option value="tsp">teaspoon</option><option value="ml">millilitres</option></select></div></div><div class="form-group"><label class="form-label">Meal Type</label><select class="form-select" id="qty-meal-type"><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option>Snack</option></select></div><div id="qty-preview" style="text-align:center;margin:12px 0;padding:12px;background:var(--bg-input);border-radius:8px;"><div style="font-size:1.5rem;font-weight:700;color:var(--warning);" id="qty-cal-display">0</div><div style="font-size:0.75rem;color:var(--text-secondary);margin-top:4px;" id="qty-macro-display">P: 0g ‚Ä¢ C: 0g ‚Ä¢ F: 0g</div></div><button class="btn btn-primary" onclick="confirmAddFood()">Add to Log</button></div></div>
    <div class="modal-overlay" id="edit-meal-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">‚úèÔ∏è Edit Meal</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('edit-meal-modal')">‚úï</button></div><div class="form-group"><label class="form-label">Food Name</label><input type="text" class="form-input" id="edit-meal-name"></div><div class="form-row"><div class="form-group"><label class="form-label">Calories</label><input type="number" class="form-input" id="edit-meal-calories" oninput="updateEditPreview()"></div><div class="form-group"><label class="form-label">Quantity</label><input type="number" class="form-input" id="edit-meal-quantity" value="1" min="0.1" step="0.1" oninput="updateEditPreview()"></div></div><div class="form-row-3"><div class="form-group"><label class="form-label">Protein</label><input type="number" class="form-input" id="edit-meal-protein" step="0.1"></div><div class="form-group"><label class="form-label">Carbs</label><input type="number" class="form-input" id="edit-meal-carbs" step="0.1"></div><div class="form-group"><label class="form-label">Fat</label><input type="number" class="form-input" id="edit-meal-fat" step="0.1"></div></div><div class="form-group"><label class="form-label">Meal Type</label><select class="form-select" id="edit-meal-type"><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option>Snack</option></select></div><p id="edit-meal-preview" style="text-align:center;margin:12px 0;color:var(--warning);font-weight:600;">0 calories total</p><button class="btn btn-primary" onclick="saveEditedMeal()">Save Changes</button></div></div>
    <div class="modal-overlay" id="scanner-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">üì∑ Scan Barcode</h3><button class="modal-close" aria-label="Close scanner" onclick="closeScannerModal()">‚úï</button></div><div class="scanner-container" id="scanner-container"><div id="scanner-viewport"></div><div class="scanner-overlay"></div><div class="scanner-laser" id="scanner-laser"></div><button class="scanner-torch" id="scanner-torch" onclick="toggleTorch()" title="Toggle flashlight">üî¶</button></div><div class="scanner-status" id="scanner-status">Point camera at barcode...</div><div class="scan-progress" id="scan-progress"><div class="scan-dot"></div><div class="scan-dot"></div><div class="scan-dot"></div></div><div class="form-group" style="margin-top:12px;"><label class="form-label">Or enter barcode manually:</label><div style="display:flex;gap:8px;"><input type="text" class="form-input" id="manual-barcode" placeholder="e.g. 5000128000000" inputmode="numeric"><button class="btn btn-secondary btn-sm" style="width:auto;" onclick="manualLookup()">Lookup</button></div></div><div id="scan-history-container"></div><div id="scanned-product-info" style="display:none;"><div class="scanned-product"><div class="scanned-product-name" id="scanned-name">-</div><div class="scanned-product-brand" id="scanned-brand">-</div><div id="scan-data-warning"></div><div class="form-group" style="margin:10px 0;"><label class="form-label">Serving Size</label><select class="form-select" id="serving-size-select" onchange="updateServingDisplay()"><option value="100">Per 100g</option></select></div><div class="scanned-product-macros"><div><div class="value" id="scanned-cal">0</div><div class="label">Cal</div></div><div><div class="value" id="scanned-protein">0g</div><div class="label">Protein</div></div><div><div class="value" id="scanned-carbs">0g</div><div class="label">Carbs</div></div><div><div class="value" id="scanned-fat">0g</div><div class="label">Fat</div></div></div><div class="form-group" style="margin-top:10px;"><label class="form-label">Custom amount (g)</label><div style="display:flex;gap:8px;align-items:center;"><input type="number" class="form-input" id="custom-serving" placeholder="e.g. 150" style="flex:1;" oninput="updateCustomServing()"><span id="custom-serving-result" style="font-size:0.85rem;color:var(--warning);font-weight:600;min-width:60px;"></span></div></div></div><div class="btn-group"><button class="btn btn-primary" onclick="addScannedToLog()">Add to Today</button><button class="btn btn-secondary" onclick="addScannedToDatabase()">Save to Foods</button></div></div></div></div>
    <div class="modal-overlay" id="template-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">üç≥ Create Meal Template</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('template-modal')">‚úï</button></div><div class="form-group"><label class="form-label">Template Name</label><input type="text" class="form-input" id="template-name" placeholder="e.g. My Breakfast"></div><div class="form-group"><label class="form-label">Meal Type</label><select class="form-select" id="template-meal-type"><option>Breakfast</option><option>Lunch</option><option>Dinner</option><option>Snack</option></select></div><p style="font-size:0.8rem;color:var(--text-secondary);margin:10px 0;">This will save today's logged meals as a template</p><button class="btn btn-primary" onclick="createTemplate()">Save as Template</button></div></div>
    <div class="modal-overlay" id="weight-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">‚öñÔ∏è Log Weight</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('weight-modal')">‚úï</button></div><div class="form-group"><label class="form-label">Weight (kg)</label><input type="number" class="form-input" id="weight-input" step="0.1" placeholder="e.g. 75.5"></div><div class="form-group"><label class="form-label">Date</label><input type="date" class="form-input" id="weight-date"></div><div class="form-group"><label class="form-label">Progress Photo (optional)</label><div style="display:flex;gap:8px;"><button class="btn btn-outline btn-sm" onclick="captureProgressPhoto()" style="flex:1;">üì∑ Take Photo</button><button class="btn btn-outline btn-sm" onclick="selectProgressPhoto()" style="flex:1;">üñºÔ∏è Choose Photo</button></div><input type="file" id="progress-photo-input" accept="image/*" capture="environment" style="display:none"><input type="file" id="progress-photo-select" accept="image/*" style="display:none"><div id="photo-preview" style="margin-top:8px;"></div></div><button class="btn btn-primary" onclick="logWeight()">Save Weight</button></div></div>
    <div class="modal-overlay" id="exercise-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">üèÉ Log Exercise</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('exercise-modal')">‚úï</button></div><div class="form-group"><label class="form-label">Search Activity</label><input type="text" class="form-input" id="exercise-search" placeholder="Search 400+ exercises..." oninput="debouncedFilterExercises()"></div><div class="category-tabs" id="exercise-cats" style="margin-bottom:10px;"><button class="category-tab active" data-excat="All" onclick="filterExercisesCat(this)">All</button><button class="category-tab" data-excat="Cardio" onclick="filterExercisesCat(this)">Cardio</button><button class="category-tab" data-excat="Strength" onclick="filterExercisesCat(this)">Strength</button><button class="category-tab" data-excat="HIIT" onclick="filterExercisesCat(this)">HIIT</button><button class="category-tab" data-excat="Flexibility" onclick="filterExercisesCat(this)">Flexibility</button><button class="category-tab" data-excat="Sports" onclick="filterExercisesCat(this)">Sports</button><button class="category-tab" data-excat="Daily" onclick="filterExercisesCat(this)">Daily</button><button class="category-tab" data-excat="Other" onclick="filterExercisesCat(this)">Other</button></div><div id="exercise-list" class="scrollable-list" style="max-height:300px;margin-bottom:10px;"></div><div id="exercise-inputs-cardio"><div class="form-group"><label class="form-label">Duration (minutes)</label><input type="number" class="form-input" id="exercise-duration" placeholder="30" oninput="updateExercisePreview()"></div></div><div id="exercise-inputs-strength" style="display:none;"><div class="form-row-3"><div class="form-group"><label class="form-label">Sets</label><input type="number" class="form-input" id="exercise-sets" placeholder="4" value="4" oninput="updateExercisePreview()"></div><div class="form-group"><label class="form-label">Reps</label><input type="number" class="form-input" id="exercise-reps" placeholder="10" value="10" oninput="updateExercisePreview()"></div><div class="form-group"><label class="form-label">Weight (kg)</label><input type="number" class="form-input" id="exercise-weight" placeholder="50" oninput="updateExercisePreview()"></div></div><div class="form-group"><label class="form-label">Rest between sets (seconds)</label><input type="number" class="form-input" id="exercise-rest" placeholder="60" value="60" oninput="updateExercisePreview()"></div></div><div id="exercise-preview" style="text-align:center;padding:12px;background:var(--bg-input);border-radius:8px;margin:10px 0;"><span style="color:var(--text-secondary);">Select an exercise above</span></div><button class="btn btn-primary" onclick="logExercise()">Add Exercise</button></div></div>
    <div class="modal-overlay" id="export-modal"><div class="modal"><div class="modal-header"><h3 class="modal-title">üì§ Export Report</h3><button class="modal-close" aria-label="Close dialog" onclick="closeModal('export-modal')">‚úï</button></div><div class="form-group"><label class="form-label">Time Range</label><select class="form-select" id="export-range" onchange="updateExportPreview()"><option value="7">Last 7 days</option><option value="30" selected>Last 30 days</option><option value="90">Last 3 months</option><option value="all">All data</option><option value="custom">Custom range</option></select></div><div id="export-custom-dates" style="display:none;"><div class="form-row"><div class="form-group"><label class="form-label">From</label><input type="date" class="form-input" id="export-from"></div><div class="form-group"><label class="form-label">To</label><input type="date" class="form-input" id="export-to"></div></div></div><div id="export-preview" style="background:var(--bg-input);border-radius:8px;padding:12px;margin:12px 0;font-size:0.85rem;"></div><div class="form-group"><label class="form-label">Export Format</label><div class="btn-group" style="flex-wrap:wrap;"><button class="btn btn-secondary btn-sm" onclick="exportPDF()" style="flex:1;min-width:100px;">üìÑ PDF Report</button><button class="btn btn-outline btn-sm" onclick="exportCSV()" style="flex:1;min-width:100px;">üìä CSV/Excel</button><button class="btn btn-outline btn-sm" onclick="exportJSON()" style="flex:1;min-width:100px;">üíæ JSON Backup</button></div></div><p style="font-size:0.75rem;color:var(--text-secondary);margin-top:8px;">CSV format is compatible with MyFitnessPal, Cronometer, and other fitness apps.</p></div></div>
    <div class="modal-overlay" id="feedback-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">üí¨ Send Feedback</h3>
                <button class="modal-close" aria-label="Close dialog" onclick="closeModal('feedback-modal')">‚úï</button>
            </div>
            <div class="form-group">
                <label class="form-label">Your Name (optional)</label>
                <input type="text" class="form-input" id="feedback-name" placeholder="John Smith">
            </div>
            <div class="form-group">
                <label class="form-label">Email (optional - for reply)</label>
                <input type="email" class="form-input" id="feedback-email" placeholder="you@example.com">
            </div>
            <div class="form-group">
                <label class="form-label">Feedback Type</label>
                <select class="form-select" id="feedback-type">
                    <option>üí° Feature Request</option>
                    <option>üêõ Bug Report</option>
                    <option>‚ùì Question</option>
                    <option>üëç Compliment</option>
                    <option>üí≠ Other</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">Your Message</label>
                <textarea class="form-input" id="feedback-message" rows="5" placeholder="Tell us what you think..." style="resize:vertical;min-height:100px;"></textarea>
            </div>
            <div id="feedback-status" style="display:none;margin:10px 0;padding:10px;border-radius:8px;text-align:center;"></div>
            <button class="btn btn-primary" onclick="sendFeedback()" id="feedback-submit">Send Feedback</button>
        </div>
    </div>
    <div class="toast" id="toast" role="status" aria-live="polite"></div>
    <div class="celebration-overlay" id="celebration">
        <div class="celebration-content">
            <div class="celebration-emoji" id="celebration-emoji">üéâ</div>
            <div class="celebration-title" id="celebration-title">Amazing!</div>
            <div class="celebration-subtitle" id="celebration-subtitle">You reached your goal!</div>
            <button class="btn btn-primary" style="margin-top:24px;" onclick="closeCelebration()">Continue</button>
        </div>
    </div>
    <div class="onboarding-overlay" id="onboarding" style="display:none;">
        <div class="onboarding-card">
            <div class="onboarding-step active" data-step="1">
                <div><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZmZmZiIgcng9IjIwIi8+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMTBiOTgxIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzA1OTY2OSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0NiIgcj0iMzYiIGZpbGw9InVybCgjZykiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjQ2IiByPSIyOCIgZmlsbD0iI2ZmZiIvPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNDYiIHI9IjIyIiBmaWxsPSJub25lIiBzdHJva2U9IiNFNUU3RUIiIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtZGFzaGFycmF5PSIxMDQiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNTAgNDYpIi8+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0NiIgcj0iMjIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzEwYjk4MSIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1kYXNoYXJyYXk9IjEwNCIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjI5IiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNTAgNDYpIi8+CiAgPHRleHQgeD0iNTAiIHk9IjQ0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMUUyOTNCIj4xLDQ4MDwvdGV4dD4KICA8dGV4dCB4PSI1MCIgeT0iNTMiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZiIgZm9udC1zaXplPSI1IiBmaWxsPSIjNjQ3NDhCIj5rY2FsPC90ZXh0PgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iI0VGNDQ0NCIvPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iIzNCODJGNiIvPgogIDxjaXJjbGUgY3g9IjYwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iI0Y1OUUwQiIvPgogIDx0ZXh0IHg9IjQwIiB5PSI2My4yIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmb250LXNpemU9IjIuNSIgZmlsbD0iI2ZmZiI+UDwvdGV4dD4KICA8dGV4dCB4PSI1MCIgeT0iNjMuMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zaXplPSIyLjUiIGZpbGw9IiNmZmYiPkM8L3RleHQ+CiAgPHRleHQgeD0iNjAiIHk9IjYzLjIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMi41IiBmaWxsPSIjZmZmIj5GPC90ZXh0PgogIDx0ZXh0IHg9IjUwIiB5PSI5MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zaXplPSI4IiBmaWxsPSIjMDU5NjY5Ij5DYWxvcmllUHJvPC90ZXh0Pgo8L3N2Zz4K" alt="CaloriePro Logo" style="width:64px;height:64px;display:block;margin:0 auto 8px;"></div>
                <div class="onboarding-title">Welcome to CaloriePro!</div>
                <div class="onboarding-text">Your private health companion. Everything stays on your device.</div>
                <div class="onboarding-features">
                    <div class="onboarding-feature"><div class="of-icon">üìä</div><div class="of-text">Track calories & macros</div></div>
                    <div class="onboarding-feature"><div class="of-icon">üèÉ</div><div class="of-text">Log exercise & steps</div></div>
                    <div class="onboarding-feature"><div class="of-icon">üì∑</div><div class="of-text">Scan barcodes</div></div>
                    <div class="onboarding-feature"><div class="of-icon">üîí</div><div class="of-text">100% private & offline</div></div>
                </div>
                <div class="onboarding-dots"><div class="onboarding-dot active"></div><div class="onboarding-dot"></div><div class="onboarding-dot"></div><div class="onboarding-dot"></div></div>
                <button class="btn btn-primary" onclick="nextOnboardingStep()">Let's Go!</button>
            </div>
            <div class="onboarding-step" data-step="2">
                <div style="font-size:2.5rem;margin-bottom:8px;">üë§</div>
                <div class="onboarding-title">About you</div>
                <div class="onboarding-text">We'll calculate your personal calorie target.</div>
                <div class="form-group" style="text-align:left;margin-bottom:12px;"><label class="form-label">Your Name</label><input type="text" class="form-input" id="onboard-name" placeholder="Enter your name"></div>
                <div class="form-row" style="text-align:left;">
                    <div class="form-group"><label class="form-label">Age</label><input type="number" class="form-input" id="onboard-age" placeholder="30"></div>
                    <div class="form-group"><label class="form-label">Gender</label><select class="form-select" id="onboard-gender"><option>Male</option><option>Female</option><option>Other</option></select></div>
                </div>
                <div class="onboarding-dots"><div class="onboarding-dot"></div><div class="onboarding-dot active"></div><div class="onboarding-dot"></div><div class="onboarding-dot"></div></div>
                <button class="btn btn-primary" onclick="nextOnboardingStep()">Continue</button>
            </div>
            <div class="onboarding-step" data-step="3">
                <div style="font-size:2.5rem;margin-bottom:8px;">üìè</div>
                <div class="onboarding-title">Your measurements</div>
                <div class="form-row" style="text-align:left;">
                    <div class="form-group"><label class="form-label">Height (cm)</label><input type="number" class="form-input" id="onboard-height" placeholder="175"></div>
                    <div class="form-group"><label class="form-label">Weight (kg)</label><input type="number" class="form-input" id="onboard-weight" placeholder="70"></div>
                </div>
                <div class="form-row" style="text-align:left;">
                    <div class="form-group"><label class="form-label">Goal Weight (kg)</label><input type="number" class="form-input" id="onboard-goal-weight" placeholder="65" step="0.1"></div>
                    <div class="form-group"><label class="form-label">Activity Level</label><select class="form-select" id="onboard-activity"><option>Sedentary (office job)</option><option>Light (1-2 days/week)</option><option selected>Moderate (3-5 days/week)</option><option>Active (6-7 days/week)</option><option>Very Active (athlete)</option></select></div>
                </div>
                <div class="onboarding-dots"><div class="onboarding-dot"></div><div class="onboarding-dot"></div><div class="onboarding-dot active"></div><div class="onboarding-dot"></div></div>
                <button class="btn btn-primary" onclick="nextOnboardingStep()">Continue</button>
            </div>
            <div class="onboarding-step" data-step="4">
                <div style="font-size:2.5rem;margin-bottom:8px;">üéØ</div>
                <div class="onboarding-title">Your plan</div>
                <div class="form-group" style="text-align:left;"><label class="form-label">Goal</label><select class="form-select" id="onboard-goal"><option>Lose Weight (-500 cal/day)</option><option selected>Maintain Weight</option><option>Gain Muscle (+300 cal/day)</option></select></div>
                <div id="onboard-result" style="background:var(--bg-input);border-radius:12px;padding:16px;margin:12px 0;"><div style="font-size:0.85rem;color:var(--text-secondary);">Your daily target:</div><div style="font-size:2rem;font-weight:700;color:var(--primary);" id="onboard-calories">2000</div><div style="font-size:0.85rem;color:var(--text-secondary);">calories per day</div></div>
                <div style="margin-bottom:12px;">
                    <div style="font-size:0.8rem;font-weight:600;margin-bottom:6px;text-align:left;">Choose theme:</div>
                    <div class="theme-selector" id="onboard-theme-selector">
                        <div class="theme-opt active" data-theme="dark" onclick="setOnboardTheme('dark')"><span class="theme-opt-icon">üåô</span>Dark</div>
                        <div class="theme-opt" data-theme="light" onclick="setOnboardTheme('light')"><span class="theme-opt-icon">‚òÄÔ∏è</span>Light</div>
                    </div>
                </div>
                <div class="onboarding-dots"><div class="onboarding-dot"></div><div class="onboarding-dot"></div><div class="onboarding-dot"></div><div class="onboarding-dot active"></div></div>
                <button class="btn btn-primary" onclick="completeOnboarding()">Start Tracking! üöÄ</button>
            </div>
        </div>
    </div>
    <input type="file" id="import-file" accept=".json" style="display:none">
    <div class="tutorial-overlay" id="tutorial-overlay">
        <div class="tutorial-card">
            <div class="tutorial-slide active" data-slide="1">
                <div class="tutorial-image" style="background:linear-gradient(135deg,#6366f1,#4f46e5);">
                    <div class="tutorial-icon"><img src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMDAgMTAwIj4KICA8cmVjdCB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgZmlsbD0iI2ZmZmZmZiIgcng9IjIwIi8+CiAgPGRlZnM+CiAgICA8bGluZWFyR3JhZGllbnQgaWQ9ImciIHgxPSIwJSIgeTE9IjAlIiB4Mj0iMTAwJSIgeTI9IjEwMCUiPgogICAgICA8c3RvcCBvZmZzZXQ9IjAlIiBzdG9wLWNvbG9yPSIjMTBiOTgxIi8+CiAgICAgIDxzdG9wIG9mZnNldD0iMTAwJSIgc3RvcC1jb2xvcj0iIzA1OTY2OSIvPgogICAgPC9saW5lYXJHcmFkaWVudD4KICA8L2RlZnM+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0NiIgcj0iMzYiIGZpbGw9InVybCgjZykiLz4KICA8Y2lyY2xlIGN4PSI1MCIgY3k9IjQ2IiByPSIyOCIgZmlsbD0iI2ZmZiIvPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNDYiIHI9IjIyIiBmaWxsPSJub25lIiBzdHJva2U9IiNFNUU3RUIiIHN0cm9rZS13aWR0aD0iNSIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBzdHJva2UtZGFzaGFycmF5PSIxMDQiIHN0cm9rZS1kYXNob2Zmc2V0PSIwIiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNTAgNDYpIi8+CiAgPGNpcmNsZSBjeD0iNTAiIGN5PSI0NiIgcj0iMjIiIGZpbGw9Im5vbmUiIHN0cm9rZT0iIzEwYjk4MSIgc3Ryb2tlLXdpZHRoPSI1IiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1kYXNoYXJyYXk9IjEwNCIgc3Ryb2tlLWRhc2hvZmZzZXQ9IjI5IiB0cmFuc2Zvcm09InJvdGF0ZSgxMzUgNTAgNDYpIi8+CiAgPHRleHQgeD0iNTAiIHk9IjQ0IiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmb250LXNpemU9IjEyIiBmaWxsPSIjMUUyOTNCIj4xLDQ4MDwvdGV4dD4KICA8dGV4dCB4PSI1MCIgeT0iNTMiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZiIgZm9udC1zaXplPSI1IiBmaWxsPSIjNjQ3NDhCIj5rY2FsPC90ZXh0PgogIDxjaXJjbGUgY3g9IjQwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iI0VGNDQ0NCIvPgogIDxjaXJjbGUgY3g9IjUwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iIzNCODJGNiIvPgogIDxjaXJjbGUgY3g9IjYwIiBjeT0iNjIiIHI9IjIuNSIgZmlsbD0iI0Y1OUUwQiIvPgogIDx0ZXh0IHg9IjQwIiB5PSI2My4yIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIiBmb250LWZhbWlseT0iSGVsdmV0aWNhLEFyaWFsLHNhbnMtc2VyaWYiIGZvbnQtd2VpZ2h0PSJib2xkIiBmb250LXNpemU9IjIuNSIgZmlsbD0iI2ZmZiI+UDwvdGV4dD4KICA8dGV4dCB4PSI1MCIgeT0iNjMuMiIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zaXplPSIyLjUiIGZpbGw9IiNmZmYiPkM8L3RleHQ+CiAgPHRleHQgeD0iNjAiIHk9IjYzLjIiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZvbnQtZmFtaWx5PSJIZWx2ZXRpY2EsQXJpYWwsc2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZvbnQtc2l6ZT0iMi41IiBmaWxsPSIjZmZmIj5GPC90ZXh0PgogIDx0ZXh0IHg9IjUwIiB5PSI5MCIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9IkhlbHZldGljYSxBcmlhbCxzYW5zLXNlcmlmIiBmb250LXdlaWdodD0iYm9sZCIgZm9udC1zaXplPSI4IiBmaWxsPSIjMDU5NjY5Ij5DYWxvcmllUHJvPC90ZXh0Pgo8L3N2Zz4K" alt="CaloriePro Logo" style="width:60px;height:60px;display:block;margin:16px auto;"></div>
                    <div class="tutorial-mockup">
                        <div style="text-align:center;">
                            <span style="font-size:1.5rem;font-weight:700;display:block;">CaloriePro</span>
                        </div>
                    </div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Welcome to CaloriePro!</div>
                    <div class="tutorial-text">Your personal calorie tracker that keeps all your data private and secure on your device. No account needed, no ads, everything included.</div>
                    <div class="tutorial-tip">
                        üí° <strong>All your data stays on your iPhone</strong> - we don't collect or share anything!
                    </div>
                </div>
            </div>
            <div class="tutorial-slide" data-slide="2">
                <div class="tutorial-image">
                    <div class="tutorial-icon">üè†</div>
                    <div class="tutorial-mockup">
                        <div style="text-align:center;font-size:2rem;">1,450</div>
                        <div style="text-align:center;font-size:0.7rem;color:#94a3b8;">of 2,000 cal</div>
                    </div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Dashboard Overview</div>
                    <div class="tutorial-text">The dashboard shows your daily progress. The main ring fills as you log calories. Progress rings below show protein, carbs, fat and water.</div>
                    <div class="tutorial-tip">üí° <strong>Tip:</strong> Use the ‚Üê ‚Üí buttons to view past days!</div>
                </div>
            </div>
            <div class="tutorial-slide" data-slide="3">
                <div class="tutorial-image" style="background:linear-gradient(135deg,#3b82f6,#1d4ed8);">
                    <div class="tutorial-icon">üçΩÔ∏è</div>
                    <div class="tutorial-mockup">
                        <div style="display:flex;gap:8px;justify-content:center;margin-bottom:8px;">
                            <span style="background:var(--primary);padding:4px 8px;border-radius:4px;font-size:0.7rem;">üåÖ Breakfast</span>
                            <span style="background:var(--bg-input);padding:4px 8px;border-radius:4px;font-size:0.7rem;">‚òÄÔ∏è Lunch</span>
                        </div>
                        <div style="background:var(--bg-input);border-radius:6px;padding:8px;font-size:0.7rem;">üîç Search foods...</div>
                    </div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Adding Food</div>
                    <div class="tutorial-text">Tap the green + button anytime. Select a meal type, then search from 5,000+ UK foods or scan a barcode to quickly add items.</div>
                    <div class="tutorial-tip">üí° <strong>Tip:</strong> Tap the green + button for quick food logging!</div>
                </div>
            </div>
            <div class="tutorial-slide" data-slide="4">
                <div class="tutorial-image" style="background:linear-gradient(135deg,#f59e0b,#d97706);">
                    <div class="tutorial-icon">üìÖ</div>
                    <div class="tutorial-mockup">
                        <div style="display:grid;grid-template-columns:repeat(7,1fr);gap:2px;font-size:0.5rem;">
                            <div style="background:var(--primary);border-radius:3px;padding:4px;text-align:center;">1</div>
                            <div style="background:var(--primary);border-radius:3px;padding:4px;text-align:center;">2</div>
                            <div style="background:var(--bg-input);border-radius:3px;padding:4px;text-align:center;">3</div>
                            <div style="background:var(--primary);border-radius:3px;padding:4px;text-align:center;">4</div>
                            <div style="background:var(--bg-input);border-radius:3px;padding:4px;text-align:center;">5</div>
                            <div style="background:var(--primary);border-radius:3px;padding:4px;text-align:center;">6</div>
                            <div style="border:2px solid #f59e0b;border-radius:3px;padding:2px;text-align:center;">7</div>
                        </div>
                    </div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Calendar & History</div>
                    <div class="tutorial-text">The Log page shows a calendar. Tap any day to view and edit that day's meals, water, exercise and mood.</div>
                    <div class="tutorial-tip">üí° <strong>Tip:</strong> Green days = logged. Swipe on dashboard to change days!</div>
                </div>
            </div>
            <div class="tutorial-slide" data-slide="5">
                <div class="tutorial-image" style="background:linear-gradient(135deg,#8b5cf6,#6d28d9);">
                    <div class="tutorial-icon">üòä</div>
                    <div class="tutorial-mockup">
                        <div style="display:flex;justify-content:space-around;font-size:1.2rem;">
                            <span style="opacity:0.4;">üò¢</span>
                            <span style="opacity:0.4;">üòî</span>
                            <span style="opacity:0.4;">üòê</span>
                            <span>üòä</span>
                            <span style="opacity:0.4;">üòÑ</span>
                        </div>
                    </div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Track Your Mood</div>
                    <div class="tutorial-text">Log how you feel each day. Over time, you'll see patterns between your diet and wellbeing in the Reports section.</div>
                    <div class="tutorial-tip">üí° <strong>Tip:</strong> Add notes about sleep, energy or how meals made you feel!</div>
                </div>
            </div>
            <div class="tutorial-slide" data-slide="6">
                <div class="tutorial-image" style="background:linear-gradient(135deg,#ef4444,#dc2626);">
                    <div class="tutorial-icon">üèÉ</div>
                    <div class="tutorial-mockup">
                        <div style="font-size:0.7rem;text-align:center;">
                            <div>Running - 30 min</div>
                            <div style="color:var(--primary);font-weight:bold;">-285 cal</div>
                        </div>
                    </div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">Log Exercise</div>
                    <div class="tutorial-text">Track cardio and strength training. Calories burned are calculated using your body weight and MET values for accurate results.</div>
                    <div class="tutorial-tip">üí° <strong>Tip:</strong> Exercise calories are subtracted from your daily total!</div>
                </div>
            </div>
            <div class="tutorial-slide" data-slide="7">
                <div class="tutorial-image" style="background:linear-gradient(135deg,#10b981,#059669);">
                    <div class="tutorial-icon">üéâ</div>
                </div>
                <div class="tutorial-content">
                    <div class="tutorial-title">You're All Set!</div>
                    <div class="tutorial-text">Start tracking your meals and watch your progress. Remember: all your data stays private on your device.</div>
                    <div class="tutorial-tip">üí° <strong>Need help?</strong> Go to Profile ‚Üí Show Tutorial anytime!</div>
                </div>
            </div>
            <div class="tutorial-nav">
                <button class="tutorial-btn secondary" id="tutorial-skip" onclick="closeTutorial()">Skip</button>
                <div class="tutorial-dots" id="tutorial-dots">
                    <div class="tutorial-dot active"></div>
                    <div class="tutorial-dot"></div>
                    <div class="tutorial-dot"></div>
                    <div class="tutorial-dot"></div>
                    <div class="tutorial-dot"></div>
                    <div class="tutorial-dot"></div>
                    <div class="tutorial-dot"></div>
                </div>
                <button class="tutorial-btn primary" id="tutorial-next" onclick="nextTutorialSlide()">Next</button>
            </div>
        </div>
    </div>
    <script defer src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    <script src="foods-db.js"></script>
    <script src="exercises-db.js"></script>
    <script src="app.js"></script>
</body>
</html>
